function encodeURL(a){return a.replace(/\+/g,"-").replace(/\//g,"_")}var ObjectId=function(){function a(){return this instanceof ObjectId?void("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=d,this.pid=c,this.increment=b++,b>16777215&&(b=0))):new ObjectId(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}var b=0,c=Math.floor(32767*Math.random()),d=Math.floor(16777216*Math.random());if("undefined"!=typeof localStorage){var e=parseInt(localStorage.mongoMachineId);e>=0&&16777215>=e&&(d=Math.floor(localStorage.mongoMachineId)),localStorage.mongoMachineId=d,document.cookie="mongoMachineId="+d+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}else{var f=document.cookie.split("; ");for(var g in f){var h=f[g].split("=");if("mongoMachineId"==h[0]&&h[1]>=0&&h[1]<=16777215){d=h[1];break}}document.cookie="mongoMachineId="+d+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}return a}();ObjectId.prototype.getDate=function(){return new Date(1e3*this.timestamp)},ObjectId.prototype.toArray=function(){var a,b=this.toString(),c=[];for(a=0;12>a;a++)c[a]=parseInt(b.slice(2*a,2*a+2),16);return c},ObjectId.prototype.toString=function(){var a=this.timestamp.toString(16),b=this.machine.toString(16),c=this.pid.toString(16),d=this.increment.toString(16);return"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-b.length)+b+"0000".substr(0,4-c.length)+c+"000000".substr(0,6-d.length)+d},function(a){a.countLines=function(b,c){var d={recalculateCharWidth:!0,charsMode:"random",fontAttrs:["font-family","font-size","text-decoration","font-style","font-weight"]};c=a.extend({},d,c);var e,f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";b.jquery||(b=a(b));var g=b.val();switch(c.charsMode){case"random":for(c.chars="",f+=".,?!-+;:'\"",e=1;12>=e;e++)c.chars+=f[Math.floor(Math.random()*f.length)];break;case"alpha":c.chars=f;break;case"alpha_extended":c.chars=f+".,?!-+;:'\"";break;case"from_ta":if(g.length<15)c.chars=f;else for(e=1;15>=e;e++)c.chars+=g[Math.floor(Math.random()*g.length)];break;case"custom":}a.isArray(c.chars)||(c.chars=c.chars.split(""));var h="";for(e=1;10>=e;e++)h+=Math.floor(10*Math.random())+1;b.after("<span id='s"+h+"'></span>");var i=a("#s"+h);i.hide(),a.each(c.fontAttrs,function(a,c){i.css(c,b.css(c))});var j,k=g.split("\n"),l=k.length;if(c.recalculateCharWidth||null==b.data("average_char")){var m=c.chars,n=m.length,o=0;a.each(m,function(a,b){i.text(b),o+=i.width()}),b.data("average_char",Math.ceil(o/n))}j=b.data("average_char"),i.remove();var p,q=2*(b.outerWidth()-b.width()),r=0,s=0,t=0;a.each(k,function(c,d){if(p=(d.length+1)*j+q,p>=b.outerWidth()){var e=Math.floor(p/b.outerWidth());s+=e,r++}""===a.trim(d)&&t++});var u={};return u.actual=l,u.wrapped=r,u.wraps=s,u.visual=l+s,u.blank=t,u}}(jQuery),moment.locale("en-short",{calendar:{lastDay:"[Yesterday]",sameDay:"LT",nextDay:"[Tomorrow]",lastWeek:"dddd",nextWeek:"[Next] dddd",sameElse:"ll"}}),angular.module("App",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","lbServices","services","notifications","filters","directives","ui.router","angularModalService","pascalprecht.translate","angulartics","angulartics.google.analytics"]).config(["$locationProvider",function(a){a.html5Mode(!0).hashPrefix("!")}]).config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"locales/en.",suffix:".json"}),a.preferredLanguage("en-GB"),a.useLocalStorage()}]).config(["$analyticsProvider",function(a){a.settings.trackRelativePath=!0}]).config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","$injector",function(a,b,c){return{responseError:function(d){if(401===d.status){var e=c.get("$state");e.get(b.path().split("/")[1])&&e.get(b.path().split("/")[1]).public||(b.nextAfterLogin=b.path(),localStorage.nextAfterLogin=b.nextAfterLogin,b.path("/signin"))}return a.reject(d)}}}])}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.rule(function(a,b){var c,d=b.path(),e=b.search();if("/"!==d[d.length-1])return 0===Object.keys(e).length?d+"/":(c=[],angular.forEach(e,function(a,b){c.push(b+"="+a)}),d+"/?"+c.join("&"))}),b.when("/verify-email","/signin").when("/verify-email/","/signin").otherwise("/chat/"),a.state("home",{url:"/","abstract":!0,views:{mainview:{templateUrl:"views/home.html",controller:"homeCtrl"}}}).state("home.rooms",{url:"",views:{"roomsView@home":{templateUrl:"views/home.rooms.html",controller:"roomsCtrl"},"chatView@home":{templateUrl:"views/home.chat.html"}}}).state("signin",{url:"/signin/",views:{"mainview@":{templateUrl:"views/signin.html",controller:"signinCtrl"}},"public":!0}).state("signup",{url:"/signup/",views:{"mainview@":{templateUrl:"views/signin.html",controller:"signinCtrl"}},"public":!0}).state("verify-email",{url:"/verify-email/",views:{"mainview@":{templateUrl:"views/signin.html",controller:"signinCtrl"}},"public":!0}).state("reset-password",{url:"/reset-password/{resetPasswordToken}/",views:{"mainview@":{templateUrl:"views/signin.html",controller:"signinCtrl"}},"public":!0}).state("legal",{url:"/legal/",views:{"mainview@":{templateUrl:function(){},controller:"legalCtrl"}},"public":!0}).state("newRoom",{url:"/newroom/",views:{"mainview@":{templateUrl:"views/newRoom.html",controller:"newRoomCtrl"}}}).state("contacts",{url:"/contacts/",views:{"mainview@":{templateUrl:"views/contacts.html",controller:"contactsCtrl"}}}).state("contacts.add",{url:"add/",views:{"mainview@":{templateUrl:"views/contacts.add.html",controller:"contactsAddCtrl"}}}).state("profile",{url:"/profile/:id/",views:{"mainview@":{templateUrl:"views/profile.html",controller:"profileCtrl"}}}).state("recover-account",{url:"/recover-account/",views:{"mainview@":{templateUrl:"views/signin.html",controller:"signinCtrl"}},"public":!0}).state("deactivated",{url:"/deactivated/",views:{"mainview@":{templateUrl:"views/deactivated.html"}}}).state("notfound",{url:"/notfound/",views:{"mainview@":{template:"",controller:["$location","toaster","$translate",function(a,b,c){return b.pop("warning",c("Ad"),c("The Ad you requested does not exist.")),a.path("/")}]}},"public":!0}).state("settings",{url:"/settings/",views:{"mainview@":{templateUrl:"views/settings.html",controller:"settingsCtrl"}}}).state("home.rooms.chat",{url:":id/",views:{"chatView@home":{templateUrl:"views/home.chat.html",controller:"chatCtrl"}}}).state("home.rooms.chat.details",{url:"details/",views:{"chatDetailsView@home":{templateUrl:"views/home.chatDetails.html",controller:"chatDetailsCtrl"}}})}]).run(["$rootScope","$cookies","$location","AppAuth","$http","User","LoopBackAuth","$notification",function(a,b,c,d,e,f,g,h){if(h.enableHtml5Mode(),b.userId&&b.access_token&&(g.currentUserId=b.userId||null,g.accessTokenId=b.access_token||"",g.rememberMe=!0,g.save()),delete b.userId,delete b.access_token,d.ensureHasCurrentUser(f),localStorage.nextAfterLogin){var i=c.nextAfterLogin||localStorage.nextAfterLogin||"/";localStorage.removeItem("nextAfterLogin"),c.path(i)}Visibility.change(function(a,b){"visible"===b&&(g.currentUserId=localStorage.$LoopBack$currentUserId||sessionStorage.$LoopBack$currentUserId||null,g.accessTokenId=localStorage.$LoopBack$accessTokenId||sessionStorage.$LoopBack$accessTokenId||null,d.ensureHasCurrentUser(f))})}]),angular.module("filters",[]).filter("caasTime",function(){return function(a){return moment.locale("en-short"),moment(new Date(1e3*parseInt(a.toString().slice(0,8),16))).calendar()}}),angular.module("services",["lbServices"]).factory("AppAuth",["$location","LoopBackAuth","$window",function(a,b,c){return{currentUser:{},imagesLoading:0,ensureHasCurrentUser:function(c){if(this.currentUser&&this.currentUser.id){if(!b.currentUserId||!b.accessTokenId)return this.logout(c)}else if(b.currentUserId&&b.accessTokenId){var d=this;console.log(d.currentUser),d.currentUser=c.getCurrent(function(b){d.currentUser.queue||(d.currentUser.queue={}),d.currentUser.queueEvents||(d.currentUser.queueEvents={}),c.prototype$getChatRooms({id:d.currentUser.id},function(c){console.log(c),d.currentUser.chatRooms=c.chatRooms,b.username?a.path("/signup"):"/signin/"===a.path()&&a.path("/")},function(){})},function(a){return 404===a.status?d.logout(c):void 0})}else a.path("/signin")},logout:function(d){var e=this;d.logout(function(){e.currentUser=null,b.currentUserId="",b.accessTokenId="",b.rememberMe=!0,b.save(),a.path("/"),c.location.reload()},function(d){d&&"could not find accessToken"===d.data.error.message&&(e.currentUser=null,b.currentUserId="",b.accessTokenId="",b.rememberMe=!0,b.save(),a.path("/"),c.location.reload())})}}}]).factory("socket",["$rootScope","LoopBackAuth","AppAuth","$notification",function(a,b,c,d){return{socket:!1,connect:function(){var a=this;a.socket||(a.socket=io("/",{query:"access_token="+b.accessTokenId}),a.on("connection",function(){console.log("connect")}),a.on("connection_error",function(){console.log("connect_error")}),a.on("chat",function(a){if(console.log("chat",a),"startConversation"===a.type){var b=c.currentUser.chatRooms.filter(function(b){return b.id===a.chatRoom.id});if(b.length)for(var e=0;e<a.chatRoom.users.length;e++)b[0].users.filter(function(b){return b.id===a.chatRoom.users[e].id}).length||b[0].users.push(a.chatRoom.users[e]);else a.chatRoom.noMore=!0,a.chatRoom.events||(a.chatRoom.events=[]),c.currentUser.chatRooms.push(a.chatRoom);a=a.event||a.events}Array.isArray(a)||(a=[a]);for(var f=0;f<a.length;f++)for(var g=c.currentUser.chatRooms.length-1;g>=0;g--)if(c.currentUser.chatRooms[g].id===a[f].chatRoom||a[f].chatRooms&&-1!==a[f].chatRooms.indexOf(c.currentUser.chatRooms[g].id))if(-1!==a[f].type.indexOf("update"))if("update:seen"===a[f].type)c.currentUser.chatRooms[g].seen?c.currentUser.chatRooms[g].seen.filter(function(b){return b.user===a[f].seen.user}).length?c.currentUser.chatRooms[g].seen.filter(function(b){return b.user===a[f].seen.user})[0].date=a[f].seen.date:c.currentUser.chatRooms[g].seen.push(a[f].seen):c.currentUser.chatRooms[g].seen=[a[f].seen];else for(var e=c.currentUser.chatRooms[g].users.length-1;e>=0;e--)c.currentUser.chatRooms[g].users[e].id===a[f].sender&&("update:writting"===a[f].type?c.currentUser.chatRooms[g].users[e].writting=!0:"update:stoppedWritting"===a[f].type&&(c.currentUser.chatRooms[g].users[e].writting=!1));else{if("notification:changeName"===a[f].type)c.currentUser.chatRooms[g].name=a[f].text.substring(a[f].text.indexOf("to: ")+4,a[f].text.length);else if("notification:removeUser"===a[f].type){for(var e=0;e<c.currentUser.chatRooms[g].users.length;e++)c.currentUser.chatRooms[g].users[e].id===a[f].removedUser&&c.currentUser.chatRooms[g].users.splice(e,1);c.currentUser.chatRooms[g].oldUsers||(c.currentUser.chatRooms[g].oldUsers=[]),c.currentUser.chatRooms[g].oldUsers.push(a[f].removedUser)}c.currentUser.chatRooms[g].events.push(a[f]),c.currentUser.chatRooms[g].doNotDisturb||a[f].sender===c.currentUser.id||d.notify("custom","",c.currentUser.chatRooms[g].users.filter(function(b){return b.id===a[f].sender})[0].name,a[f].text,c.currentUser.chatRooms[g].id,2e3)}}))},on:function(b,c){var d=this;d.socket.on(b,function(){var b=arguments;a.$apply(function(){c.apply(d.socket,b)})})},emit:function(b,c,d){var e=this;e.socket.emit(b,c,function(){var b=arguments;a.$apply(function(){d&&d.apply(e.socket,b)})})},json:{send:function(b,c){var d=this;d.socket.json.send(b,function(){var b=arguments;a.$apply(function(){c&&c.apply(d.socket,b)})})}}}}]).factory("Utils",function(){return{groupify:function(a,b){for(var c,d,c=0;c<a.length;c++)d=a[c].name.charAt(0),b[d]||(b[d]={label:d,contacts:[]}),b[d].contacts.push(a[c])}}}).service("computeSlideStyle",["DeviceCapabilities",function(a){return function(b){var c={},d=a.has3d?"translate3d("+b+"px, 0, 0)":"translate3d("+b+"px, 0)";return a.transformProperty?c[a.transformProperty]=d:c["margin-left"]=b+"px",c}}]),function(a){"use strict";"function"==typeof define&&define.amd?define(["angular"],a):a("object"==typeof exports?require("angular"):angular)}(function(a){var b=a.module("notifications",[]);return b.provider("$notification",function(){function b(a,c,d){function e(d,e,g,h,i,j){if("moz"==f.html5Mode){d||(d="favicon.ico");try{b=c.Notification||c.mozNotification;var k=new b(e,{body:g,dir:"auto",lang:"",tag:"test",icon:d})}catch(l){f.html5Mode=!1}}else if("webkit"==f.html5Mode)if(0===c.webkitNotifications.checkPermission()){d||(d="favicon.ico");var k=c.webkitNotifications.createNotification(d,e,g);"function"==typeof h&&(k.ondisplay=h),"function"==typeof i&&(k.onclose=i),k.show()}else f.html5Mode=!1;j?a(function(){k.close()},j):k.onclose=function(){console.log("close"),c.blur(),a(c.focus,0),this.close()}}var f=d,g=JSON.parse(localStorage.getItem("$notifications"))||[],h=[];return{disableHtml5Mode:function(){f.html5Mode=!1},disableType:function(a){f[a].enabled=!1},enableHtml5Mode:function(){f.html5Mode=this.requestHtml5ModePermissions()},enableType:function(a){f[a].enabled=!0},getSettings:function(){return f},toggleType:function(a){f[a].enabled=!f[a].enabled},toggleHtml5Mode:function(){f.html5Mode=!f.html5Mode},requestHtml5ModePermissions:function(){return c.Notification||c.mozNotification?(b=c.Notification||c.mozNotification,void b.requestPermission(function(a){f.html5Mode="granted"==a?"moz":!1})):c.webkitNotifications?0===c.webkitNotifications.checkPermission()?!0:(c.webkitNotifications.requestPermission(function(){f.html5Mode=0===c.webkitNotifications.checkPermission()?"webkit":!1}),!1):!1},getAll:function(){return g},getQueue:function(){return h},info:function(a,b,c,d){return this.notify("info","info",a,b,c,d)},error:function(a,b,c,d){return this.notify("error","error",a,b,c,d)},success:function(a,b,c,d){return this.notify("success","success",a,b,c,d)},warning:function(a,b,c,d){return this.notify("warning","warning",a,b,c,d)},notify:function(a,b,c,d,e,f){return this.makeNotification(a,!1,b,c,d,e,f)},makeNotification:function(b,c,d,i,j,k,l){if("visible"!==Visibility.state()){var m={type:b,image:c,icon:d,title:i,content:j,timestamp:+new Date,userData:k,duration:l,"class":f[b].class};return g.push(m),void 0===l&&(l=f[b].duration),f.html5Mode?e(c,i,j,function(){},function(){},l):(h.push(m),l&&a(function(){h.splice(h.indexOf(m),1)},l)),this.save(),m}},save:function(){f.localStorage&&localStorage.setItem("$notifications",JSON.stringify(g))},restore:function(){},clear:function(){g=[],this.save()}}}var c={info:{duration:5e3,enabled:!0,"class":"info"},warning:{duration:5e3,enabled:!0,"class":"warning"},error:{duration:5e3,enabled:!0,"class":"danger"},success:{duration:5e3,enabled:!0,"class":"success"},progress:{duration:0,enabled:!0,"class":""},custom:{duration:35e3,enabled:!0,"class":""},details:!0,localStorage:!1,html5Mode:!1,templateName:"ng-notification-template"};this.setSettings=function(b){a.extend(c,b)},this.$get=["$timeout","$window","$templateCache",function(a,d,e){return e.get("ng-notification-template")||e.put("ng-notification-template",'<div class="ng-notification-wrapper" ng-repeat="noti in queue"><div class="ng-notification alert alert-{{noti.class}}"><div class="ng-notification-content"><button type="button" class="close" data-dismiss="modal" ng-click="removeNotification(noti)"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button><span class="title" ng-bind="noti.title"></span></div></div></div>'),new b(a,d,c)}]}),b.directive("notifications",["$notification","$compile","$templateCache",function(a,b,c){function d(a,b,c){var d=c.notifications;d=d.split(" "),b.addClass("ng-notification-container");for(var e=0;e<d.length;e++)b.addClass(d[e])}return{restrict:"A",scope:{},template:c.get(a.getSettings().templateName),link:d,controller:["$scope",function(b){b.queue=a.getQueue(),b.removeNotification=function(a){b.queue.splice(b.queue.indexOf(a),1)}}]}}]),b}),angular.module("directives",[]).directive("caasTime",function(){return{link:function(a,b,c){return moment.locale("en"),b.text(moment(new Date(1e3*parseInt(c.caasTime.toString().slice(0,8),16))).calendar())}}}).directive("caasTimeStamp",function(){return{link:function(a,b,c){return moment.locale("en"),b.text(moment(new Date(1e3*parseInt(c.caasTimeStamp.toString().slice(0,8),16))).format("LT"))}}}).directive("whenScrolledChat",["$timeout",function(a){return function(b,c,d){var e=c[0],f=!1;c.bind("scroll",function(){f&&(f=!1),!b.forceScrollReset&&!b.loading&&e.scrollTop<=100?(f=e.scrollHeight,b.$apply(d.whenScrolledChat).then(function(){a(function(){f&&(e.scrollTop=e.scrollHeight-f)})})):e.scrollTop+e.clientHeight===e.scrollHeight&&(!b.currentChatRoom.seen||!b.currentChatRoom.seen.filter(function(a){return a.user===b.currentUser.id}).length||new Date(b.currentChatRoom.seen.filter(function(a){return a.user===b.currentUser.id})[0].date)<new Date(1e3*parseInt(b.currentChatRoom.events[b.currentChatRoom.events.length-1].id.toString().slice(0,8),16)))&&(b.updateSeen(),b.$apply())})}}]).directive("whenScrolled",["$timeout",function(){return function(a,b,c){var d=b[0];b.bind("scroll",function(){!a.currentChatRoom.loadingFiles&&d.scrollHeight-d.scrollTop<=d.clientHeight+100&&a.$apply(c.whenScrolled)})}}]).directive("seenSrc",function(){return{link:function(a,b){return b.attr("src",a.currentChatRoom.users.filter(function(b){return b.id===a.seen.user})[0].photo||"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAiIGhlaWdodD0iMTQwIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjcwIiB5PSI3MCIgc3R5bGU9ImZpbGw6I2FhYTtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxMnB4O2ZvbnQtZmFtaWx5OkFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjE0MHgxNDA8L3RleHQ+PC9zdmc+")}}}).directive("photoSrc",function(){return{link:function(a,b){var c=a.currentChatRoom.users.filter(function(b){return b.id===a.event.sender})[0]||a.currentChatRoom.oldUsers.filter(function(b){return b.id===a.event.sender})[0];return b.attr("src",c.photo||"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNDAiIGhlaWdodD0iMTQwIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHRleHQtYW5jaG9yPSJtaWRkbGUiIHg9IjcwIiB5PSI3MCIgc3R5bGU9ImZpbGw6I2FhYTtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxMnB4O2ZvbnQtZmFtaWx5OkFyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmO2RvbWluYW50LWJhc2VsaW5lOmNlbnRyYWwiPjE0MHgxNDA8L3RleHQ+PC9zdmc+")}}}).directive("imgLoaded",function(){return{scope:!0,compile:function(){return{post:function(a,b){if(!a.currentChatRoom.initialLoading){var c=document.getElementById("chat");b.imagesLoaded().always(function(){c.scrollTop=c.scrollHeight}).done(function(){}).fail(function(){})}}}}}}).directive("imageSrc",["$timeout",function(a){return{link:function(b,c,d){a(function(){var a=c.width(),b=c.height();-1===d.imageSrc.indexOf("http")&&(d.imageSrc="http:"+d.imageSrc);for(var e=0;e<photoSizesWidths.length;e++)if(photoSizesWidths[e]<a){for(var f=0;f<photoSizesHeights.length;f++)if(photoSizesHeights[f]<b){var g=(photoSizesWidths[e-1]?photoSizesWidths[e-1]:photoSizesWidths[e])+"x"+(photoSizesHeights[f-1]?photoSizesHeights[f-1]:photoSizesHeights[f]);c.attr("src","//d10nrrb1q7v7qu.cloudfront.net/"+encodeURL(CryptoJS.enc.Base64.stringify(CryptoJS.HmacSHA1("trim/"+g+"/smart/"+d.imageSrc,"qwerty")))+"/trim/"+g+"/smart/"+d.imageSrc),f=photoSizesHeights.length+1}e=photoSizesWidths.length+1}},0)}}}]).directive("arrowBackground",function(){return{link:function(a,b,c){b.append("<style scoped>"+c.arrowBackground+"</style>"),c.$observe("arrowBackground",function(){b.children("style").remove(),b.append("<style scoped>"+c.arrowBackground+"</style>")})}}}).directive("backAnimation",["$browser","$location",function(a,b){return{link:function(c,d){a.onUrlChange(function(a){b.absUrl()===a&&d.addClass("reverse")}),c.__childrenCount=0,c.$watch(function(){c.__childrenCount=d.children().length}),c.$watch("__childrenCount",function(a,b){a!==b&&1===a&&d.removeClass("reverse")})}}}]),angular.module("App").controller("navigationCtrl",["$scope","AppAuth","User",function(a,b,c){a.toggleMenu=function(a){$(".navigation").toggleClass("open"),a.stopPropagation()},a.logout=function(){b.logout(c)},a.stopPropagation=function(a){a.stopPropagation()}}]).controller("headerCtrl",["$scope","$location","$window","ChatRoom",function(a,b,c,d){a.details=!1,a.loading=!1,a.from="/_chat/",-1!=b.path().indexOf("details")&&(a.details=!0),a.$on("$stateChangeSuccess",function(b,c){a.details=-1!==c.name.indexOf("details")?!0:!1}),a.goBack=function(){c.history.back()},a.toggleMenu=function(a){$(".navigation").toggleClass("open"),a.stopPropagation()},a.toggleEditName=function(){!a.currentChatRoom.appPage&&a.isActiveUser()&&(a.editingName=!a.editingName,a.currentChatRoom.newChatRoomName=a.currentChatRoom.name?angular.copy(a.currentChatRoom.name):"")},a.editNameKeydown=function(b){13===b.which&&(b.preventDefault(),console.log(a.currentChatRoom.newChatRoomName),a.currentChatRoom.newChatRoomName!==a.currentChatRoom.name&&d.prototype$changeName({id:a.currentChatRoom.id},{name:a.currentChatRoom.newChatRoomName},function(a){console.log(a)},function(a){console.log(a)}),a.toggleEditName())},$(".content").removeClass("reverse")}]).controller("homeCtrl",["$scope","AppAuth","$state","socket","ChatRoom","$q","$window","$location",function(a,b,c,d,e,f,g,h){if(a.currentUser=b.currentUser,a.currentChatRoom=!1,a.roomList="personal",a.windowWidth=g.innerWidth,a.$on("$stateChangeSuccess",function(b,c,d){if(a.windowWidth=g.innerWidth,a.currentUser&&a.currentUser.chatRooms&&a.currentUser.chatRooms.length){if(a.currentChatRoom=a.currentUser.chatRooms.filter(function(a){return a.id===d.id})[0],a.currentChatRoom&&!a.currentChatRoom.imagesLoading&&(a.currentChatRoom.imagesLoading=0),-1!==c.name.indexOf("home.rooms.chat")&&!a.currentChatRoom)return h.path("/");a.currentChatRoom&&!a.currentChatRoom.message&&(a.currentChatRoom.message={text:"",url:!1}),a.currentChatRoom&&a.currentChatRoom.events.length<2&&a.getChatRoomEvents()}else a.currentChatRoom=!1}),a.getChatRoomEvents=function(){var b=f.defer();if(a.currentChatRoom.loading||!a.currentChatRoom||a.currentChatRoom.noMore)b.reject();else{a.currentChatRoom.loading=!0;var c=a.currentChatRoom.id;e.prototype$__get__event({id:c,filter:{where:{users:a.currentUser.id},order:"id DESC",skip:a.currentChatRoom.events.length,limit:10}},function(d){var e=a.currentUser.chatRooms.filter(function(a){return a.id===c})[0];e.loading=!1,d.length<10&&(e.noMore=!0),d.length&&!e.events.filter(function(a){return a.id===d[0].id}).length&&([].push.apply(d.reverse(),e.events),e.events=d),b.resolve()},function(){var b=a.currentUser.chatRooms.filter(function(a){return a.id===c})[0];b.loading=!1})}return b.promise},g.onresize=function(){a.windowWidth=g.innerWidth;var b=document.getElementById("chat");b.style.top=b.scrollHeight<=b.clientHeight&&b.clientHeight<=$("body").innerHeight()-40?"auto":0,a.$apply()},a.setup=function(){if(d.connect(),c.params&&a.currentUser&&a.currentUser.chatRooms&&a.currentUser.chatRooms.length)a.currentChatRoom=a.currentUser.chatRooms.filter(function(a){return a.id===c.params.id})[0],a.currentChatRoom&&!a.currentChatRoom.imagesLoading&&(a.currentChatRoom.imagesLoading=0),a.currentChatRoom&&a.currentChatRoom.events&&a.currentChatRoom.events.length<2&&a.getChatRoomEvents(),a.currentChatRoom&&a.currentChatRoom.appPageId&&(a.roomList="business");else if(-1!==c.current.name.indexOf("home.rooms.chat")&&!a.currentChatRoom)return h.path("/");a.$watchCollection("currentUser.chatRooms",function(){a.currentUser=b.currentUser,c.params&&a.currentUser&&a.currentUser.chatRooms&&a.currentUser.chatRooms.length&&(a.currentChatRoom=a.currentUser.chatRooms.filter(function(a){return a.id===c.params.id})[0],a.currentChatRoom&&!a.currentChatRoom.imagesLoading&&(a.currentChatRoom.imagesLoading=0),-1===c.current.name.indexOf("home.rooms.chat")||a.currentChatRoom||h.path("/"),a.currentChatRoom&&!a.currentChatRoom.message&&(a.currentChatRoom.message={text:"",url:!1}),a.currentUser.chatRooms.sort(function(a,b){return a.events.length&&(a=a.events[a.events.length-1]),b.events.length&&(b=b.events[b.events.length-1]),new Date(1e3*parseInt(b.id.toString().slice(0,8),16))-new Date(1e3*parseInt(a.id.toString().slice(0,8),16))}))})},a.isActiveUser=function(){return a.currentUser&&a.currentChatRoom&&a.currentChatRoom.users.filter(function(b){return b.id===a.currentUser.id}).length},a.currentUser&&a.currentUser.id)a.setup();else var i=a.$watch("currentUser",function(){a.currentUser&&a.currentUser.id&&a.currentUser.chatRooms&&!d.socket&&(a.setup(),i())},!0)}]).controller("roomsCtrl",["$scope","$location",function(a,b){a.openChatRoom=function(){b.path("/"+this.chatRoom.id)},a.changeRoomList=function(b){a.roomList=b,a.searchFilter=""},a.checkUnseen=function(){return this.chatRoom.events.length&&this.chatRoom.events[this.chatRoom.events.length-1].sender!==a.currentUser.id?new Date(this.chatRoom.seen.filter(function(b){return b.user===a.currentUser.id})[0].date)<new Date(1e3*parseInt(this.chatRoom.events[this.chatRoom.events.length-1].id.toString().slice(0,8),16)):!1}}]).controller("chatCtrl",["$scope","socket","$timeout","$window","User",function(a,b,c,d){a.forceScrollReset=!0,a.$on("$stateChangeSuccess",function(){c(function(){a.currentChatRoom&&(!a.currentChatRoom.seen||!a.currentChatRoom.seen.filter(function(b){return b.user===a.currentUser.id}).length||a.currentChatRoom.events.length&&new Date(a.currentChatRoom.seen.filter(function(b){return b.user===a.currentUser.id})[0].date)<new Date(1e3*parseInt(a.currentChatRoom.events[a.currentChatRoom.events.length-1].id.toString().slice(0,8),16)))&&a.updateSeen()})}),a.$watchCollection("currentChatRoom.events",function(b,d){b&&d&&c(function(){var e=document.getElementById("chat");b.length>d.length&&("auto"===e.style.top||e.scrollTop+e.clientHeight===e.scrollHeight)&&a.currentChatRoom&&(!a.currentChatRoom.seen||!a.currentChatRoom.seen.filter(function(b){return b.user===a.currentUser.id}).length||new Date(a.currentChatRoom.seen.filter(function(b){return b.user===a.currentUser.id})[0].date)<new Date(1e3*parseInt(a.currentChatRoom.events[a.currentChatRoom.events.length-1].id.toString().slice(0,8),16)))&&(a.updateSeen(),a.$apply()),a.checkSize(),(d&&d.length<2||a.forceScrollReset||e.clientHeight+e.scrollTop+60>=e.scrollHeight||!b[b.length-1].sender)&&(c(function(){e.scrollTop=e.scrollHeight}),a.forceScrollReset&&c(function(){a.forceScrollReset=!1},100))},0)}),a.checkSize=function(){var b=document.getElementById("chat");b.scrollHeight<=b.clientHeight&&b.clientHeight<=$("body").innerHeight()-40?(b.style.top="auto",a.currentChatRoom.noMore||a.getChatRoomEvents().then(function(){c(function(){a.forceScrollReset=!0})})):(b.style.top=0,a.currentChatRoom.initialLoading=!0)},a.$watch("currentChatRoom.seen",function(b){if(b){for(var c=0;c<a.currentChatRoom.events.length;c++)a.currentChatRoom.events[c].seen&&(a.currentChatRoom.events[c].seen=null);for(var c=0;c<b.length;c++)if(b[c].user!==a.currentUser.id)for(var d=!1,e=a.currentChatRoom.events.length-1;e>=0;e--)!d&&new Date(b[c].date)>new Date(1e3*parseInt(a.currentChatRoom.events[e].id.toString().slice(0,8),16))&&(a.currentChatRoom.events[e].seen?a.currentChatRoom.events[e].seen.push(b[c]):a.currentChatRoom.events[e].seen=[b[c]],d=!0)}},!0),d.onfocus=function(){var b=document.getElementById("chat");("auto"===b.style.top||b.scrollTop+b.clientHeight===b.scrollHeight)&&a.currentChatRoom&&(!a.currentChatRoom.seen||!a.currentChatRoom.seen.filter(function(b){return b.user===a.currentUser.id}).length||a.currentChatRoom.events.length&&new Date(a.currentChatRoom.seen.filter(function(b){return b.user===a.currentUser.id})[0].date)<new Date(1e3*parseInt(a.currentChatRoom.events[a.currentChatRoom.events.length-1].id.toString().slice(0,8),16)))&&(a.updateSeen(),a.$apply())},$(".home > .view").addClass("chatRoom"),a.$on("$destroy",function(){$(".home > .view").removeClass("chatRoom"),d.onfocus=function(){}}),a.updateSeen=function(){if(a.currentChatRoom.seen){var c=a.currentChatRoom.seen.filter(function(b){return b.user===a.currentUser.id});if(c.length)c=c[0],c.date=new Date;else{var c={user:a.currentUser.id,date:new Date};a.currentChatRoom.seen.push(c)}}else{var c={user:a.currentUser.id,date:new Date};a.currentChatRoom.seen=[c]}b.emit("chat",{chatRoom:a.currentChatRoom.id,seen:c,type:"update:seen"})},a.chatBoxFocus=function(){console.log("focus")},a.chatDblClick=function(){console.log("dblClick")},c(function(){var a=document.getElementById("chat");a.scrollTop=a.scrollHeight})}]).controller("chatFooterCtrl",["$scope","socket","$timeout","$window","User","ChatRoom",function(a,b,c,d,e){a.menu=!1,a.menuPhoto=!1,a.menuVideo=!1,a.menuLocation=!1,a.menuAttach=!1,a.sendMessage=function(){var b={chatRoom:a.currentChatRoom.id,type:"message",text:a.currentChatRoom.message.text};(!a.currentChatRoom.events.length||Math.floor((new Date-new Date(1e3*parseInt(a.currentChatRoom.events[a.currentChatRoom.events.length-1].id.toString().slice(0,8),16)))/6e4)>60)&&(b.startSession=!0);var d=ObjectId().toString();e.events.create({id:a.currentUser.id},b,function(b){for(var c=0;c<a.currentChatRoom.events.length;c++)a.currentChatRoom.events[c].id===d&&(a.currentChatRoom.events[c]=b)},function(a){console.error(a)}),c(function(){b.id=d,a.currentChatRoom.events.push(b),a.currentChatRoom.message.text="",a.currentChatRoom.message.url=!1,$("#chatBox").removeClass("expanded")},0)},a.updateChatBox=function(){var c=$.countLines("#chatBox");if(c.actual>1){$("#chatView").addClass("expandedChatBox");var d=document.getElementById("chat");d.style.top=d.scrollHeight<=d.clientHeight&&d.clientHeight<=$("body").innerHeight()-40?"auto":0,d.clientHeight+d.scrollTop+16===d.scrollHeight&&(d.scrollTop=d.scrollHeight)}else $("#chatView").removeClass("expandedChatBox");!a.writting&&a.currentChatRoom.message.text.length?(a.writting=!0,b.emit("chat",{chatRoom:a.currentChatRoom.id,type:"update:writting"})):a.writting&&!a.currentChatRoom.message.text.length&&(a.writting=!1,b.emit("chat",{chatRoom:a.currentChatRoom.id,type:"update:stoppedWritting"})),a.currentChatRoom.message.url||(a.currentChatRoom.message.url=a.currentChatRoom.message.text.match(/((?:(http|https|Http|Https|rtsp|Rtsp):\/\/(?:(?:[a-zA-Z0-9\$\-\_\.\+\!\*\'\(\)\,\;\?\&\=]|(?:\%[a-fA-F0-9]{2})){1,64}(?:\:(?:[a-zA-Z0-9\$\-\_\.\+\!\*\'\(\)\,\;\?\&\=]|(?:\%[a-fA-F0-9]{2})){1,25})?\@)?)?((?:(?:[a-zA-Z0-9][a-zA-Z0-9\-]{0,64}\.)+(?:(?:aero|arpa|asia|a[cdefgilmnoqrstuwxz])|(?:biz|b[abdefghijmnorstvwyz])|(?:cat|com|coop|c[acdfghiklmnoruvxyz])|d[ejkmoz]|(?:edu|e[cegrstu])|f[ijkmor]|(?:gov|g[abdefghilmnpqrstuwy])|h[kmnrtu]|(?:info|int|i[delmnoqrst])|(?:jobs|j[emop])|k[eghimnrwyz]|l[abcikrstuvy]|(?:mil|mobi|museum|m[acdghklmnopqrstuvwxyz])|(?:name|net|n[acefgilopruz])|(?:org|om)|(?:pro|p[aefghklmnrstwy])|qa|r[eouw]|s[abcdeghijklmnortuvyz]|(?:tel|travel|t[cdfghjklmnoprtvwz])|u[agkmsyz]|v[aceginu]|w[fs]|y[etu]|z[amw]))|(?:(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9])\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[0-9])))(?:\:\d{1,5})?)(\/(?:(?:[a-zA-Z0-9\;\/\?\:\@\&\=\#\~\-\.\+\!\*\'\(\)\,\_])|(?:\%[a-fA-F0-9]{2}))*)?(?:\b|$)/gi),a.currentChatRoom.message.url&&(a.currentChatRoom.message.url=a.currentChatRoom.message.url[0],e.prototype$getParseUrl({id:a.currentUser.id,url:a.currentChatRoom.message.url},function(b){a.currentChatRoom.message.url=b.site_name||b.image?b:!1},function(b){console.log(b),a.currentChatRoom.message.url=!1
})))},a.clearMessageUrl=function(){a.currentChatRoom.message.url=!1},a.send=function(){(a.currentChatRoom.message.text.length||a.currentChatRoom.message.url||a.currentChatRoom.queue)&&a.sendMessage()},a.chatBoxKeydown=function(b){if(13!==b.which||b.shiftKey){if(13===b.which&&b.shiftKey){var c=$.countLines("#chatBox");(c.actual=1)&&$("#chatView").addClass("expandedChatBox")}}else a.send(),b.preventDefault()}}]).controller("chatDetailsCtrl",["$scope","User","$timeout","ChatRoom","ModalService",function(a,b,c,d,e){$(".home > .view").addClass("details"),a.$on("$destroy",function(){$(".home > .view").removeClass("details")}),a.menuLocation=!1,a.doNotDisturb=function(){d.update({where:{id:a.currentChatRoom.id}},{doNotDisturb:a.currentChatRoom.doNotDisturb},function(){},function(a){a&&console.error(a)})},a.leaveConversation=function(){a.menuLeaveConversation=!a.menuLeaveConversation},a.leaveChatRoom=function(){d.prototype$removeUser({id:a.currentChatRoom.id,userId:a.currentUser.id},function(){for(var b=0;b<a.currentUser.chatRooms.length;b++)a.currentUser.chatRooms[b].id===a.currentChatRoom.id&&a.currentUser.chatRooms.splice(b,1);$location.path("/")},function(a){a&&console.error(a)})},a.removeFromChatRoom=function(){var b=this;d.prototype$removeUser({id:a.currentChatRoom.id,userId:b.$parent.user.id},function(){for(var c=0;c<a.currentChatRoom.users.length;c++)a.currentChatRoom.users[c].id===b.$parent.user.id&&a.currentChatRoom.users.splice(c,1)},function(a){a&&console.error(a)})},a.addContact=function(){e.showModal({templateUrl:"views/home.addContact.html",controller:"addContactCtrl",appendElement:angular.element(".hoverview")}).then(function(){})}}]),angular.module("App").controller("signinCtrl",["$scope","$state","$stateParams","$location","User","AppAuth","LoopBackAuth",function(a,b,c,d,e,f,g){a.err=!1,a.success=!1,a.loading=!1,a.formData={},a.currentUser=f.currentUser,a.showForm=b.current.name,a.currentUser.username&&"signup"===b.current.name&&(a.formData.email=a.currentUser.email,a.formData.name=a.currentUser.name),c.resetPasswordToken&&(g.accessTokenId=c.resetPasswordToken,g.save()),a.login=function(){a.loading=!0,a.loginResult=a.currentUser.username?e.link({rememberMe:!0},a.formData,function(){a.loading=!1;var b=d.nextAfterLogin||localStorage.nextAfterLogin||"/";d.nextAfterLogin=null,localStorage.removeItem("nextAfterLogin"),f.ensureHasCurrentUser(e),d.path(b)},function(b){a.loading=!1,a.loginError=b.data.error}):e.login({rememberMe:!0},a.formData,function(){a.loading=!1;var b=d.nextAfterLogin||localStorage.nextAfterLogin||"/";d.nextAfterLogin=null,localStorage.removeItem("nextAfterLogin"),f.ensureHasCurrentUser(e),d.path(b)},function(b){a.loading=!1,a.loginError=b.data.error})},a.register=function(){a.loading=!0,a.user=a.currentUser.username?e.createAndLink(a.formData,function(){a.loading=!1,a.login()},function(b){a.loading=!1,a.registerError=b.data.error}):e.save(a.formData,function(){a.loading=!1,a.login()},function(b){a.loading=!1,a.registerError=b.data.error})},a.resetPassword=function(){a.loading=!0,a.currentUser.name||e.upsert({password:a.formData.password},function(b){a.loading=!1,console.log(b)},function(b){a.loading=!1,console.log(b),a.loginError=b.data.error})},a.recover=function(){a.loading=!0,e.resetPassword(a.formData,function(b){a.loading=!1,console.log(b)},function(b){a.loading=!1,console.log(b),a.loginError=b.data.error})}}]),angular.module("App").controller("contactsCtrl",["$scope","User","$location","$window","AppAuth","Utils",function(a,b,c,d,e,f){a.currentUser=e.currentUser,a.contacts=[],a.groups={},a._setup=!1,a.setup=function(){a._setup=!0,b.prototype$findContacts({id:e.currentUser.id},function(b){a.contacts=b,a.groups={},f.groupify(a.contacts,a.groups)},function(){})},a.currentUser&&a.currentUser.id?a.setup():a.$watch("currentUser",function(){!a._setup&&a.currentUser&&a.currentUser.id&&a.setup()},!0),a.openProfile=function(){c.path("/profile/"+this.contact.id)}}]).controller("contactsAddCtrl",["$scope","User","$location","$window","AppAuth","$timeout",function(a,b,c,d,e,f){a.searchString="",a.people=[],a.loading=!1,a.searchPeople=function(){!a.loading&&a.searchString.length>4&&(f.cancel(a.timer),a.timer=f(function(){a.loading=!0,b.find({filter:{where:{or:[{email:a.searchString}]}}},function(b){a.loading=!1,a.people=b},function(){a.loading=!1})},500))},a.openProfile=function(){c.path("/profile/"+this.person.id)},a.$on("$destroy",function(){f.cancel(a.timer)})}]).controller("contactsAddFacebookCtrl",["$scope","User","$location","$window","AppAuth",function(a,b,c,d,e){a.setup=function(){b.prototype$facebookContacts({id:e.currentUser.id},function(a){e.currentUser.contacts=a,console.log(a)},function(){})},a.currentUser&&a.currentUser.id?a.setup():a.$watch("currentUser.chatRooms",function(){a.currentUser&&a.currentUser.id&&(a.currentUser.contacts&&a.currentUser.contacts.length||a.setup())})}]).controller("contactsAddGoogleCtrl",["$scope","User","$location","$window","AppAuth",function(){}]).controller("newRoomCtrl",["$scope","User","$location","$window","AppAuth","Utils",function(a,b,c,d,e,f){a.currentUser=e.currentUser,a.contacts=[],a.groups={},a._setup=!1,a.selectedContacts=[],a.setup=function(){a._setup=!0,b.prototype$findContacts({id:e.currentUser.id},function(b){a.contacts=b,a.groups={},f.groupify(a.contacts,a.groups)},function(){})},a.currentUser&&a.currentUser.id?a.setup():a.$watch("currentUser",function(){!a._setup&&a.currentUser&&a.currentUser.id&&a.setup()},!0),a.toggleContact=function(){-1===a.selectedContacts.indexOf(this.contact)?a.selectedContacts.push(this.contact):a.selectedContacts.splice(a.selectedContacts.indexOf(this.contact),1)},a.createRoom=function(){if(a.selectedContacts.length){for(var d=[e.currentUser.id],f=0;f<a.selectedContacts.length;f++)d.push(a.selectedContacts[f].id);b.prototype$createChatRoom({id:e.currentUser.id},{users:d},function(a){a.chatRooms?(e.currentUser.chatRooms.push(a.chatRooms),c.path("/"+a.chatRooms.id)):c.path("/"+a.id)},function(){})}}}]),angular.module("App").controller("profileCtrl",["$scope","User","$stateParams","AppAuth","$location",function(a,b,c,d,e){a.currentUser=d.currentUser,a.setup=function(){b.findById({id:c.id},function(b){a.profile=b,console.log(b)},function(){})},a.currentUser&&a.currentUser.id?a.setup():a.$watch("currentUser",function(){!a.profile&&a.currentUser&&a.currentUser.id&&a.setup()},!0),a.addContact=function(){b.prototype$createContact({id:d.currentUser.id},{contactId:a.profile.id},function(b){a.currentUser.contacts=d.currentUser.contacts=b},function(){})},a.message=function(){b.prototype$createChatRoom({id:d.currentUser.id},{users:[d.currentUser.id,a.profile.id]},function(a){a.chatRooms?(d.currentUser.chatRooms.push(a.chatRooms),e.path("/"+a.chatRooms.id)):e.path("/"+a.id)},function(){})}}]),angular.module("App").controller("settingsCtrl",["$scope","$window",function(a,b){a.goBack=function(){b.history.back()}}]),angular.module("App").controller("addContactCtrl",["$scope","User","ChatRoom","$window","AppAuth","Utils","$stateParams","close",function(a,b,c,d,e,f,g,h){a.currentUser=e.currentUser,a.currentChatRoom=a.currentUser.chatRooms.filter(function(a){return a.id===g.id})[0],a.contacts=[],a.groups={},a._setup=!1,a.selectedContacts=[],a.$on("$destroy",function(){$(".hoverview").html(""),$(".hoverview").css("display","none")}),a.close=function(a){h(a,200)},a.setup=function(){a._setup=!0,b.prototype$findContacts({id:e.currentUser.id},function(b){a.contacts=b,a.groups={},f.groupify(a.contacts,a.groups);for(var c=0;c<a.contacts.length;c++)a.currentChatRoom.users.filter(function(b){return b.id===a.contacts[c].id}).length&&a.selectedContacts.push(a.contacts[c])},function(){})},a.currentUser&&a.currentUser.id?a.setup():a.$watch("currentUser",function(){!a._setup&&a.currentUser&&a.currentUser.id&&a.setup()},!0),a.toggleContact=function(){var b=this;a.currentChatRoom.users.filter(function(a){return a.id===b.contact.id}).length||(-1===a.selectedContacts.indexOf(b.contact)?a.selectedContacts.push(b.contact):a.selectedContacts.splice(a.selectedContacts.indexOf(b.contact),1))},a.createRoom=function(){if(a.selectedContacts.length<=a.currentChatRoom.users.length-1)return a.close();for(var b=[],d=0;d<a.selectedContacts.length;d++)a.currentChatRoom.users.filter(function(b){return b.id===a.selectedContacts[d].id}).length||b.push(a.selectedContacts[d].id);c.prototype$addUsers({id:a.currentChatRoom.id},{users:b},function(b){for(var c=0;c<b.length;c++)a.currentChatRoom.users.filter(function(a){return a.id===b[c].id}).length||a.currentChatRoom.users.push(b[c]);a.close()},function(a){a&&console.error(a)})},$(".hoverview").css("display","block")}]);