"use strict";angular.module("App",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","lbServices","services","ui.router","pascalprecht.translate","angulartics","angulartics.google.analytics"]).config(["$locationProvider",function(a){a.html5Mode(!0).hashPrefix("!")}]).config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"locales/en.",suffix:".json"}),a.preferredLanguage("en-GB"),a.useLocalStorage()}]).config(["$analyticsProvider",function(a){a.settings.trackRelativePath=!0}]).config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","$injector",function(a,b,c){return{responseError:function(d){if(401===d.status){var e=c.get("$state");e.get(b.path().split("/")[1]).public||""===b.path().split("/")[1]||(b.nextAfterLogin=b.path(),b.path("/signin"))}return a.reject(d)}}}])}]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.rule(function(a,b){var c,d=b.path(),e=b.search();if("/"!==d[d.length-1])return 0===Object.keys(e).length?d+"/":(c=[],angular.forEach(e,function(a,b){c.push(b+"="+a)}),d+"/?"+c.join("&"))}),b.when("/verify-email","/signin").when("/verify-email/","/signin").otherwise("/"),a.state("home",{url:"/",views:{mainview:{templateUrl:"/views/home.html",controller:"homeCtrl"}},"public":!0}).state("signin",{url:"/signin/",views:{"mainview@":{templateUrl:"/views/signin.html",controller:"signinCtrl"}},"public":!0}).state("signup",{url:"/signup/",views:{"mainview@":{templateUrl:"/views/signin.html",controller:"signinCtrl"}},"public":!0}).state("verify-email",{url:"/verify-email/",views:{"mainview@":{templateUrl:"/views/signin.html",controller:"signinCtrl"}},"public":!0}).state("reset-password",{url:"/reset-password/{resetPasswordToken}/",views:{"mainview@":{templateUrl:"/views/signin.html",controller:"signinCtrl"}},"public":!0}).state("legal",{url:"/legal/",views:{"mainview@":{templateUrl:function(){},controller:"legalCtrl"}},"public":!0}).state("account",{url:"/account/",views:{"mainview@":{templateUrl:"/views/account.html",controller:"accountCtrl"}}}).state("apps",{url:"/apps/",views:{"mainview@":{templateUrl:"/views/apps.html",controller:"appsCtrl"}}}).state("apps.app",{url:"{app}/","abstract":!0,views:{"mainview@":{templateUrl:"/views/apps.html",controller:"appsCtrl"}}}).state("apps.app.analytics",{url:"",views:{"nestedview@apps.app":{templateUrl:"/views/apps.analytics.html",controller:"appsAnalyticsCtrl"}}}).state("apps.app.settings",{url:"settings/","abstract":!0,views:{"nestedview@apps.app":{templateUrl:"/views/apps.settings.html"}}}).state("apps.app.settings.general",{url:"",views:{"nestednestedview@apps.app.settings":{templateUrl:"/views/apps.settings.general.html",controller:"appsSettingsGeneralCtrl"}}}).state("apps.app.settings.advanced",{url:"advanced/",views:{"nestednestedview@apps.app.settings":{templateUrl:"/views/apps.settings.advanced.html",controller:"appsSettingsAdvancedCtrl"}}}).state("apps.app.settings.install",{url:"install/",views:{"nestednestedview@apps.app.settings":{templateUrl:"/views/apps.settings.install.html",controller:"appsSettingsInstallCtrl"}}}).state("newapp",{url:"/newapp/",views:{"mainview@":{templateUrl:"/views/newapp.html",controller:"newappCtrl"}}}).state("recover-account",{url:"/recover-account/",views:{"mainview@":{templateUrl:"/views/signin.html",controller:"signinCtrl"}},"public":!0}).state("deactivated",{url:"/deactivated/",views:{"mainview@":{templateUrl:"/views/deactivated.html"}}}).state("notfound",{url:"/notfound/",views:{"mainview@":{template:"",controller:["$location","toaster","$translate",function(a,b,c){return b.pop("warning",c("Ad"),c("The Ad you requested does not exist.")),a.path("/")}]}},"public":!0})}]).run(["$rootScope","$cookies","$location","AppAuth","$http","User","LoopBackAuth",function(a,b,c,d,e,f,g){b.userId&&b.access_token&&(g.currentUserId=b.userId||null,g.accessTokenId=b.access_token||"",g.rememberMe=!0,g.save()),delete b.userId,delete b.access_token,d.ensureHasCurrentUser(f),Visibility.change(function(a,b){"visible"===b&&(g.currentUserId=localStorage.$LoopBack$currentUserId||sessionStorage.$LoopBack$currentUserId||null,g.accessTokenId=localStorage.$LoopBack$accessTokenId||sessionStorage.$LoopBack$accessTokenId||null,d.ensureHasCurrentUser(f))})}]),angular.module("services",["lbServices"]).factory("AppAuth",["$rootScope","$location","LoopBackAuth","$window",function(a,b,c,d){return{currentUser:{},ensureHasCurrentUser:function(d){if(this.currentUser.id){if(!c.currentUserId||!c.accessTokenId)return this.logout(d)}else if(c.currentUserId&&c.accessTokenId){var e=this;e.currentUser=d.getCurrent(function(c){d.apps({id:e.currentUser.id},function(d){e.currentUser.apps=d,c.username?b.path("/signup"):a.$broadcast("login")},function(){})},function(a){console.log(a)})}},logout:function(a){var e=this;a.logout(function(){e.currentUser=null,c.currentUserId="",c.accessTokenId="",c.rememberMe=!0,c.save(),b.path("/"),d.location.reload()},function(a){a&&"could not find accessToken"===a.data.error.message&&(e.currentUser=null,c.currentUserId="",c.accessTokenId="",c.rememberMe=!0,c.save(),b.path("/"),d.location.reload())})}}}]),angular.module("App").controller("headerCtrl",["$scope","User","$location","AppAuth",function(a,b,c,d){a.currentUser=d.currentUser,a.logout=function(){d.logout(b)},a.$on("login",function(){a.currentUser=d.currentUser})}]).controller("homeCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("App").controller("signinCtrl",["$scope","$state","$stateParams","$location","User","AppAuth","LoopBackAuth",function(a,b,c,d,e,f,g){a.err=!1,a.success=!1,a.loading=!1,a.formData={},a.currentUser=f.currentUser,a.showForm=b.current.name,a.currentUser.username&&"signup"===b.current.name&&(a.formData.email=a.currentUser.email,a.formData.name=a.currentUser.name),c.resetPasswordToken&&(g.accessTokenId=c.resetPasswordToken,g.save()),a.login=function(){a.loading=!0,a.loginResult=a.currentUser.username?e.link({rememberMe:!1},a.formData,function(){a.loading=!1;var b=d.nextAfterLogin||"/";d.nextAfterLogin=null,f.ensureHasCurrentUser(e),d.path(b)},function(b){a.loading=!1,a.loginError=b.data.error}):e.login({rememberMe:!1},a.formData,function(){a.loading=!1;var b=d.nextAfterLogin||"/";d.nextAfterLogin=null,f.ensureHasCurrentUser(e),d.path(b)},function(b){a.loading=!1,a.loginError=b.data.error})},a.register=function(){a.loading=!0,a.user=a.currentUser.username?e.createAndLink(a.formData,function(){a.loading=!1,a.login()},function(b){a.loading=!1,a.registerError=b.data.error}):e.save(a.formData,function(){a.loading=!1,a.login()},function(b){a.loading=!1,a.registerError=b.data.error})},a.resetPassword=function(){a.loading=!0,a.currentUser.name||e.upsert({password:a.formData.password},function(b){a.loading=!1,console.log(b)},function(b){a.loading=!1,console.log(b),a.loginError=b.data.error})},a.recover=function(){a.loading=!0,e.resetPassword(a.formData,function(b){a.loading=!1,console.log(b)},function(b){a.loading=!1,console.log(b),a.loginError=b.data.error})}}]),angular.module("App").controller("accountCtrl",["$scope","User","$location","AppAuth",function(a,b,c,d){return d.currentUser||d.currentUser.name?(a.formPass={},a.currentUser=d.currentUser,a.switchDeactivateAccount=function(){a.openDeactivateAccount=a.openDeactivateAccount?!1:!0},void(a.submit=function(e){switch(e){case"changepassword":b.prototype$updateAttributes({id:a.currentUser.id},{password:a.formPass.newPassword}),d.logout(b);break;case"deactivateaccount":b.deleteById({id:a.currentUser.id}),c.path("/home");break;case"changeSocialShare":console.log(a.formSocial);break;default:b.prototype$updateAttributes({id:a.currentUser.id},{name:a.currentUser.name})}})):c.replace("/signin")}]),angular.module("App").controller("appsCtrl",["$scope","$state","$location","$stateParams","AppAuth",function(a,b,c,d,e){a.currentUser=e.currentUser,a.setup=function(){return d.app?(a.currentApp=a.currentUser.apps.filter(function(a){return a.id===d.app})[0],a.currentApp?void 0:c.path("/newapp/")):c.path(a.currentUser.apps.length?"/apps/"+a.currentUser.apps[0].id+"/":"/newapp/")},a.currentUser&&a.currentUser.id&&a.currentUser.apps?a.setup():a.$watch("currentUser.apps",function(){a.currentUser&&a.currentUser.id&&a.currentUser.apps&&a.setup()})}]).controller("newappCtrl",["$scope","$location","User","AppAuth",function(a,b,c,d){a.formData={},a.createSite=function(){c.apps.create({id:d.currentUser.id},a.formData,function(c){a.loading=!1,d.currentUser.apps.push(c),b.path("/apps/"+c.id+"/")},function(b){a.loading=!1,a.registerError=b.data.error})}}]).controller("appsAnalyticsCtrl",["$scope",function(){}]).controller("appsSettingsGeneralCtrl",["$scope","App",function(a,b){a.submit=function(){b.prototype$updateAttributes({id:a.currentApp.id},{name:a.app.name},function(b){a.currentApp.name=b.name})}}]).controller("appsSettingsAdvancedCtrl",["$scope","$location","User",function(a,b,c){a.switchDeleteApp=function(){a.openDeleteApp=a.openDeleteApp?!1:!0},a.submit=function(){c.prototype$__destroyById__apps({id:a.currentUser.id,fk:a.currentApp.id},function(){for(var c=0;c<a.currentUser.apps.length;c++)a.currentUser.apps[c].id===a.currentApp.id&&a.currentUser.apps.splice(c,1);return b.path(a.currentUser.apps.length?"/apps/"+a.currentUser.apps[0].id+"/":"/newapp/")})}}]).controller("appsSettingsInstallCtrl",["$scope",function(a){a.show=function(b){"js"===b&&(a.show_js=!a.show_js)}}]);