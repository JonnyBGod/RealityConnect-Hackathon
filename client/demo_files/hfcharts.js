define(["domReady","backbonestore","highChart"],function(e,t){function i(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}var n={},r={};return i("/resources/js/app/ui-modules/charts/ui/jquery.jqplot.min.css"),r.View=t.View.extend({el:"#js-hfdemographics",settings:{getdata:!0},events:{},initialize:function(e){_.extend(this.settings,e),_.bindAll(this,"render","getCharts","loadPieChart","plotPie","loadLineGraph","plotGraph","reloadChart","countElement"),$.log("load hfchart"),this.getCharts()},reloadChart:function(e){if(e=="line"){this.plot2.destroy();var t=$(".js-chart-line");this.loadLineGraph(t)}if(e=="pie"){this.plot1.destroy();var n=$("#js-hfdemographics").find(".js-pie-chart");this.loadPieChart(n)}},getCharts:function(){var e=$("#js-hfdemographics").find(".js-pie-chart"),t=$(".js-chart-line");e&&this.loadPieChart(e),t.length>1&&this.loadLineGraph(t)},loadLineGraph:function(e){var t=[],n=[],r=this,i=0;e&&$(e).each(function(s,o){var u=$(e[s]).data("points");$.each(u,function(e,n){var s=r.countElement(null,n[1]),o=Math.max.apply(Math,n[1]);if(s!=10&&n[1].length!=0){var u={};u.name=n[0],u.data=n[1],n[2]&&(u.suffix=n[2]),t.push(u)}o>i&&(i=o,i<5&&(i=10))}),t.length>=1&&(n.data=t,n.chart=$(e[s]).attr("id"),n.numMax=i,console.log(n),r.plotGraph(n),n=[],t=[],i=0)})},countElement:function(e,t){var n=0;return $.each(t,function(t,r){r===e&&n++}),n},loadPieChart:function(e){var t=[],n=[],r=this;e&&$(e).each(function(e,i){t=$(i).find(".js-chart-pie");var s=[],o=[],u=[];$(i).find("table").each(function(e,i){$(i).find(".js-table-name").each(function(e,t){s.push($(this).text())}),$(i).find(".js-table-percentage").each(function(e,t){o.push($(this).text())}),$(i).find(".js-table-number").each(function(e,t){var n=$(this).text();n=n.replace(/\,/g,""),n=parseInt(n,10),u.push(n)}),$(s).each(function(e){var t="High School Graduate or Higher",r="Bachelor's Degree or Higher";s[e]!=t&&s[e]!=r&&n.push([s[e],parseInt(u[e])])});if(n.length>=1){this.canPlot=!0;var a=[];a.data=n,a.label=o,a.chart=t.attr("id"),r.plotPie(a),n=[]}})})},plotGraph:function(e){var t=e.data,n=e.chart,r=t[0].suffix,i=[2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013],s=e.numMax;this.plot2=new Highcharts.Chart({chart:{renderTo:n,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,height:300},credits:{enabled:!1},title:{text:"",x:-20},subtitle:{text:"",x:-20},xAxis:{categories:i,minTickInterval:2,labels:{step:2,style:{fontSize:"10px",fontFamily:"Verdana, sans-serif"}},gridLineColor:"#ebebeb",tickmarkPlacement:"on",lineColor:"#999",lineWidth:1,gridLineWidth:1},yAxis:{max:s,min:0,tickInterval:Math.round(s/4),title:{text:""},lineColor:"#999",lineWidth:1,gridLineColor:"#ebebeb",labels:{style:{fontSize:"10px",fontFamily:"Verdana, sans-serif"}}},credits:{enabled:!1},colors:["#0f65bc","#eb4547","#ffbd2b","#44bb67","#a73ad5","#4dacda","#ec647c"],tooltip:{valueSuffix:r,pointFormat:'<span style="color:{series.color}">‚óè</span>: <b>{point.y}</b><br/>',useHTML:!0},legend:{layout:"vertical",align:"center",verticalAlign:"bottom",borderWidth:0},plotOptions:{series:{connectNulls:!0}},series:t})},plotPie:function(e){var t=e.label,n=e.data,r=e.chart;this.plot1=new Highcharts.Chart({chart:{renderTo:r,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},credits:{enabled:!1},colors:["#0f65bc","#eb4547","#ffbd2b","#44bb67","#a73ad5","#4dacda","#ec647c"],tooltip:{formatter:function(){return"<b>"+this.point.name+"</b>:<br>"+Highcharts.numberFormat(this.y,0)+" <b>:</b> "+Highcharts.numberFormat(this.percentage,2)+" %"}},title:{text:null},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,distance:-50,color:"white",formatter:function(){return this.percentage.toFixed(2)+"%"}},showInLegend:!0}},legend:{itemStyle:{fontSize:"11px"},enabled:!0,layout:"vertical",align:"right",verticalAlign:"middle"},series:[{type:"pie",name:" ",data:n}]})},render:function(){}}),n=r,n})