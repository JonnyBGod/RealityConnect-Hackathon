define(["backbonestore","./views/detail"],function(e,t){exports={};var n=e.Router.extend({settings:{},routes:{"":"modeAndTab","detail/:mode/:tab/:id/*url":"detail","detail/:mode/:tab/":"modeAndTab","*default":"onDefault"},initialize:function(e){_.bindAll(this,"photos","balloon","map","amenities","quietmode","fullmode","detail","modeAndTab","callPending","onDefault"),_.extend(this.settings,e),this.listingDetailView=new t.Details({router:this}),this.isUserReady=!1,this.pending={},this.pending.amenities=!1,this.pending.quietmode=!1,HMSEvent.on("onUserReady",this.callPending,this),HMSEvent.trigger("onListingDetailRouterInitialized"),this.firstTime=!0},onDefault:function(){window.location.pathname=window.location.pathname},photos:function(){this.listingDetailView.tabsView.photos(this)},balloon:function(){this.listingDetailView.tabsView.balloon(this)},map:function(){this.listingDetailView.tabsView.map(this)},amenities:function(){this.isUserReady?this.listingDetailView.tabsView.amenities(this):this.pending.amenities=!0},quietmode:function(){this.isUserReady?this.listingDetailView.tabsView.loadQuietMode(this):this.pending.quietmode=!0},fullmode:function(){this.listingDetailView.tabsView.toggleMode("fullmode")},detail:function(e,t,n,r){this.listingDetailView.listingid!=n?this.firstTime?window.location.href="/"+r+window.location.hash:(this.listingDetailView.get(n),e&&this.listingDetailView.setMode(e),t&&this.listingDetailView.setTab(t)):this.modeAndTab(e,t)},modeAndTab:function(e,t){this.firstTime&&(this.firstTime=!1),t||(t="photos"),e&&this.listingDetailView.setMode(e),e&&this[e]&&this[e].apply&&this[e].apply(),t&&this[t]&&this[t].apply&&this[t].apply(),t&&this.listingDetailView.setTab(t)},callPending:function(){this.isUserReady=!0,this.pending.amenities&&this.amenities(),this.pending.quietmode&&this.quietmode()}}),r=null;return exports.execute=function(t){e.history.clean(),r||(r=new n(t)),e.history.restart()},exports})