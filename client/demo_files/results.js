function HMSBranding(e){e=="ON"?($("#js-branding-header").show(),$(".js-attribution-sponsor").show(),$(".js-disclaimer-all").show(),$(".js-disclaimer-sold").hide()):($("#js-branding-header").hide(),$(".js-attribution-sponsor").hide(),$(".js-disclaimer-all").hide(),$(".js-disclaimer-sold").show())}define(["backbonestore","app/models/search","text!templates/listings/results-listItem.html","app/ui-modules/tabs/base","app/shared/views/compliance","app/shared/views/branding","app/ui-modules/images/imageloader","app/mediators/form","hmsglobal","app/demographics/demographics","app/homevalue/models","app/ui-modules/miraclehome/view"],function(e,t,n,r,i,s,o,u,a,f,l,c){function T(e,t){var n=city="",r=t.split("/");return _.each(r,function(t,r){if(t!="api"&&t!="listings")if(t.length===2)n=t;else if(t.match(/-/)!=null){var i=t.split("-");e[i[1]]=i[0]}else t!=""&&(city=t)}),e.txtCSZ=_.humanize(city)+","+n,e}function C(){N||(N=new c.MiracleView),N.render()}function k(){$.each(arrPending,function(e,t){t&&t.abort&&t.abort()})}var h={},p={},d=Hogan.compile(n),v="text!templates/listings/results-listItem-Foreclosures.html",m="text!templates/search/mlsselector.html",g="text!templates/listings/results-details-breadcrumb.html",y,b,w=!1,E=!1,S=!1,x={};h.List=e.View.extend({el:"#js-list-view",name:"js-search-listing-results",settings:{},initialize:function(t){_.bindAll(this,"query","addOne","render","updateBreadCrumbsCallback","updateRoute","pathQuery","showOnlyQuery","reloadListings","updateofficeheader"),_.extend(this.settings,t),this.router=t,this.searchPageView=t.searchResultsPageView,this.collection=this.searchPageView.collection,this.model=this.searchPageView.model,this.collection.on("complete",this.render),this.brandingView=new s.Office({collection:this.collection}),this.disclosureView=new i.Disclosure({selector:".js-listitem",collection:this.collection}),this.mlsListingSourcesView=new h.MLSSelector({parent:this}),C(),navigator.userAgent.indexOf("iPad")>=0&&window.devicePixelRatio&&window.devicePixelRatio==1&&window.CompositionEvent==undefined&&($(".js-search-tabs-map").removeAttr("href"),$(".js-search-tabs-map").addClass("disabled")),setTimeout(function(){o.LazyLoad({selector:"#js-list-view"})},1e3),HMSEvent.on("onUserReady",this.onUserReady,this),this.addPlaceholders(),HMSTrackingVars.HandoffSearchType&&HMSTrackingVars.HandoffSearchType=="explicit"&&HMSTrackingVars.HandoffSiteUrl&&(this.collection.metadata.office=undefined,setTimeout(function(){window.location=decodeURIComponent(HMSTrackingVars.HandoffSiteUrl+HMSTrackingVars.HandoffSiteQuery)},1e3)),HMSEvent.on("user-refresh-hidelisting",this.reloadListings)},reloadListings:function(){this.router.tabsView.active=="list"&&this.router.execSearch("tab-list")},onUserReady:function(e){HMSEvent.trigger("user-update-savedsearch")},updateRoute:function(){},pathQuery:function(t){var n=t.model,r=n.toJSON();_.extend(r,this.collection.params);var i=t.path,s=T(r,i);n.set(s),this.query(n)},query:function(t){this.searchModel=t,this.collection.query(t.attributes)},showOnlyQuery:function(t){this.searchModel=t,this.collection.showOnlyQuery(t.attributes)},render:function(t){this.$el.find("#js-listview").empty(),$.cookie("HandoffSearchType","",{path:"/"});if(t.models.length==1&&t.metadata.searchdescriptiondata.Address&&t.metadata.searchdescriptiondata.Address!=""&&t.models[0].attributes.GlobalListingDetailURL&&t.models[0].attributes.GlobalListingDetailURL!=""){var n=t.models[0].attributes.GlobalListingDetailURL;window.location=n}else if(t.metadata.searchdescriptiondata&&t.metadata.searchdescriptiondata.HandoffSiteURL&&HMSTrackingVars.HandoffSearchType&&HMSTrackingVars.HandoffSearchType=="explicit")this.collection.metadata.office=undefined,window.location=decodeURIComponent(t.metadata.searchdescriptiondata.HandoffSiteURL+t.metadata.searchdescriptiondata.HandoffSiteQuery);else if(t.models.length==0)this.searchPageView.toggleNoListings(!0);else{this.searchPageView.toggleNoListings(!1);var r=this;_.each(t.models,function(e){r.addOne(e)}),r.finishCollecting(t);if(!r.brandingView.render||r.brandingView.render(r.collection))HMSEvent.trigger("user-update-savedlistings"),HMSEvent.trigger("user-update-savedsearch"),t.metadata.searchdescriptiondata&&this.updateBreadCrumbs(t.metadata.searchdescriptiondata),HMSEvent.trigger("ui-prepare-detaillink"),C(),this.$el.show()}this.addPlaceholders()},updateofficeheader:function(e){e.OfficeName&&$(".site-office-name").text(e.OfficeName.replace("RE/MAX",""))},updateBreadCrumbs:function(e){HMSTemplate.get(g,this.updateBreadCrumbsCallback)},updateBreadCrumbsCallback:function(e){var t="",n=this.collection.metadata.searchdescriptiondata;t=e.render(n),$("#js-breadcrumbs").replaceWith(t)},addOne:function(t){var n=this;view=new h.ListItem({model:t}),view.render(),this.$el.find("ol#js-listview").append(view.el)},updateListing:function(e){},finishCollecting:function(t){var n=this.model.toJSON();t&&t.clickedActiveTab&&t.clickedActiveTab=="mapforeclosures"?n.ForeclosuresHeader=!0:n.ForSaleHeader=!0,n.searchLocation=this.collection.metadata.searchLocation,n.resultcountformatted=this.collection.metadata.totalCount,this.router.searchView.updateHeaderResults(n),HMSEvent.trigger(this.router.name+"-render-complete"),this.router.tabsView.active=="list"&&setTimeout(function(){o.LazyLoad({selector:"#js-list-view"})},1e3),this.updateBreadCrumbs(this.collection.metadata.searchdescriptiondata),this.collection.metadata.office&&this.updateofficeheader(this.collection.metadata.office)},addPlaceholders:function(){var e=this.$el.find(".js-listitem");e.eq(2).parent("li").after('<li><aside id="rmx-sh-srp2" class="banner results-banner-nested"></aside></li>'),e.eq(5).parent("li").after('<li><aside id="rmx-sh-srp3" class="banner results-banner-nested"></aside></li>'),HMSEvent.trigger("hms-placeholders-ready")}}),h.Foreclosures=e.View.extend({el:"#js-foreclosures-view",name:"js-foreclosures",collection:new t.Foreclosures,list:"#js-foreclosures-list",settings:{},initialize:function(n){_.bindAll(this,"query","addOne","render","updateBreadCrumbsCallback","updateRoute","pathQuery","showOnlyQuery","reloadForeclosures"),_.extend(this.settings,n),this.router=n,this.searchPageView=n.searchResultsPageView,this.collection=new t.Foreclosures,this.model=this.searchPageView.model,this.collection.on("complete",this.render),navigator.userAgent.indexOf("iPad")>=0&&window.devicePixelRatio&&window.devicePixelRatio==1&&window.CompositionEvent==undefined&&($(".js-search-tabs-map").removeAttr("href"),$(".js-search-tabs-map").addClass("disabled")),setTimeout(function(){o.LazyLoad({selector:"#js-foreclosures-view"})},1e3),HMSEvent.on("onUserReady",this.onUserReady,this),this.addPlaceholders(),HMSEvent.on("user-foreclosure-reloadpage",this.reloadForeclosures),HMSEvent.on("user-foreclosure-logout",this.reloadForeclosures)},reloadForeclosures:function(){this.router.tabsView.active=="foreclosures"&&this.router.execSearch("tab-foreclosures")},onUserReady:function(e){HMSEvent.trigger("user-update-savedsearch")},updateRoute:function(){},pathQuery:function(t){var n=t.model,r=n.toJSON();_.extend(r,this.collection.params);var i=t.path,s=T(r,i);n.set(s),this.query(n)},query:function(t){this.searchModel=t,this.collection.query(t.attributes)},showOnlyQuery:function(t){this.searchModel=t,this.collection.showOnlyQuery(t.attributes)},render:function(t){this.$el.find("#js-foreclosures-list").empty(),$.cookie("HandoffSearchType","",{path:"/"});if(t.models.length==1&&t.metadata.searchdescriptiondata.Address&&t.metadata.searchdescriptiondata.Address!=""&&t.models[0].attributes.GlobalListingDetailURL&&t.models[0].attributes.GlobalListingDetailURL!=""){var n=t.models[0].attributes.GlobalListingDetailURL;window.location=n}else if(t.metadata.searchdescriptiondata&&t.metadata.searchdescriptiondata.HandoffSiteURL&&HMSTrackingVars.HandoffSearchType&&HMSTrackingVars.HandoffSearchType=="explicit")this.collection.metadata.office=undefined,window.location=decodeURIComponent(t.metadata.searchdescriptiondata.HandoffSiteURL+t.metadata.searchdescriptiondata.HandoffSiteQuery);else if(t.models.length==0)this.searchPageView.toggleNoListings(!0);else{this.searchPageView.toggleNoListings(!1);var r=this;_.each(t.models,function(e){r.addOne(e)}),r.finishCollecting(t),this.$el.show()}this.addPlaceholders()},updateofficeheader:function(e){e.OfficeName&&$(".site-office-name").text(e.OfficeName.replace("RE/MAX",""))},updateBreadCrumbs:function(e){HMSTemplate.get(g,this.updateBreadCrumbsCallback)},updateBreadCrumbsCallback:function(e){var t="",n=this.collection.metadata.searchdescriptiondata;t=e.render(n),$("#js-breadcrumbs").replaceWith(t)},show:function(e){this.router.searchResultsPageView.toggleNoListings(!1),$("#js-list-view").hide(),$("#js-recent-view").hide(),$("#js-map-view").hide(),$("#js-foreclosures-view").show(),e&&_.extend(this.collection.params,e.attributes);var t=this.collection.fetch({success:this.render});arrPending.push(t)},addOne:function(t){var n=this;view=new h.ListItem({model:t}),view.render(),this.$el.find("ol#js-foreclosures-list").append(view.el)},updateListing:function(e){},finishCollecting:function(t){var n=this.model.toJSON();t&&t.clickedActiveTab&&t.clickedActiveTab=="maplistings"?n.ForSaleHeader=!0:n.ForeclosuresHeader=!0,n.searchLocation=this.collection.metadata.searchLocation,n.resultcountformatted=this.collection.metadata.totalCount,this.router.searchView.updateHeaderResults(n),HMSEvent.trigger(this.router.name+"-render-complete"),this.router.tabsView.active=="foreclosures"&&setTimeout(function(){o.LazyLoad({selector:"#js-foreclosures-view"})},1e3),this.updateBreadCrumbs(this.collection.metadata.searchdescriptiondata),this.collection.metadata.office&&this.updateofficeheader(this.collection.metadata.office)},addPlaceholders:function(){var e=this.$el.find(".js-listitem");e.eq(2).parent("li").after('<li><aside id="rmx-sh-srp2" class="banner results-banner-nested"></aside></li>'),e.eq(5).parent("li").after('<li><aside id="rmx-sh-srp3" class="banner results-banner-nested"></aside></li>'),HMSEvent.trigger("hms-placeholders-ready")}}),h.ListItem=e.View.extend({tagName:"li",className:"results-tile-item",initialize:function(e){this.settings=e,_.bindAll(this,"render","renderCallback","remove","removeOne"),this.model.on("change",this.render),this.model.on("destroy",this.remove,this)},getDetail:function(e){e.preventDefault();var t=$(e.currentTarget),n=t.attr("href").replace(/#/,"");this.settings.router&&this.settings.router.navigate("detail/"+n),this.loadDetail()},loadDetail:function(){var e=new Todo.Detail({model:this.model,router:this.settings.router,rootEl:this.settings.rootEl});e.preRender(),e.render()},removeOne:function(e){this.model.destroy()},saveListingResponse:function(){},render:function(){if(!this.model.attributes.IsForeclosure){var e=d.render(this.model.toJSON());return this.$el.html(e),this}HMSTemplate.get(v,this.renderCallback)},renderCallback:function(e){this.ResultsListItemForeclosures=e;var t=this.ResultsListItemForeclosures.render(this.model.toJSON());return this.$el.html(t),this},remove:function(){$(this.el).remove()}}),h.Tabs=e.View.extend({name:"js-results-tabs",el:$(".js-search-tabs"),settings:{},active:"list",initialize:function(e){_.bindAll(this,"loadMap","loadRecent","loadForeclosures","loadList","showActive","preloadrecent","preloadlist","preloadmap"),this.router=e,this.searchResultsPageView=e.searchResultsPageView,HMSEvent.on("js-map-view-tab-open",this.loadMap),HMSEvent.on("js-list-view-tab-open",this.loadList),HMSEvent.on("js-recent-view-tab-open",this.loadRecent),HMSEvent.on("js-foreclosures-view-tab-open",this.loadForeclosures),this.tabs=r.execute(),b=this,this.active=b.tabs.activeTabName(),this["preload"+this.active]!=undefined&&this["preload"+this.active]!=null&&this["preload"+this.active].apply(this)},loadMap:function(){HMSBranding("ON"),this.active="map",this.searchResultsPageView.navRoute()},loadList:function(){HMSBranding("ON"),this.active="list",this.router.tabClick=!0,this.searchResultsPageView.navRoute()},preloadrecent:function(){HMSBranding("OFF"),this.searchResultsPageView.model.set("days",1095),this.searchResultsPageView.model.set("sv",!1),this.searchResultsPageView.model.set("nogeo",!0)},preloadmap:function(){HMSBranding("ON");return},preloadlist:function(){HMSBranding("ON");return},loadRecent:function(){HMSBranding("OFF"),this.active="recent",this.preloadrecent(),this.searchResultsPageView.navRoute()},loadForeclosures:function(){HMSBranding("OFF"),this.active="foreclosures",this.searchResultsPageView.navRoute()},showActive:function(e){}}),h.RecentSales=e.View.extend({el:"#js-recent-view",settings:{},name:"js-recent-sales",list:"#js-recentsales-list",collection:new t.RecentSales,item:"",initialize:function(e){k(),_.bindAll(this,"render","show","updateCount"),this.collection=new t.RecentSales,this.router=e,this.model=e.searchResultsPageView.model,setTimeout(function(){o.LazyLoad({el:this.list})},1e3)},show:function(e){var t=$.cookie("testingframeworkinfo")||"",n=t.split(","),r="B1",i=$.inArray(r,n);if(i==-1||e){e&&_.extend(this.collection.params,e.attributes);var s=this.collection.fetch({success:this.render});arrPending.push(s)}},render:function(e,t){$("#js-list-view").hide(),$("#js-map-view").hide(),$("#js-foreclosures-view").hide(),$("#js-recent-view").show();var n=e.models,r=this.$el.find(this.list),i;r.empty(),r.hide(),n.length==0?this.router.searchResultsPageView.toggleNoListings(!0):(this.router.searchResultsPageView.toggleNoListings(!1),_.each(n,function(e){i=new h.ListItem({model:e}),i.render(),r.append(i.el)}),setTimeout(function(){o.LazyLoad({el:r})},1e3),r.fadeIn("fast"),this.updateCount(e),HMSEvent.trigger(this.router.name+"-render-complete"),HMSEvent.trigger(this.name+"-render-complete",this),HMSEvent.trigger("user-update-savedsearch"))},updateCount:function(e){var t={};t.RecentHeader=!0,t.searchLocation=this.collection.metadata.searchLocation,t.resultcountformatted=this.collection.metadata.totalCount,this.router.searchView.updateHeaderResults(t)}}),h.MLSSelector=e.View.extend({el:"#js-modal-mlsselector",displayModel:{},name:"js-mlsselector",events:{"click a[data-id='js-listingsource-item']":"handleClick"},collection:new t.MLSListingSources,settings:{},initialize:function(e){_.bindAll(this,"query","render","renderCallback","handleClick","load"),this.settings.el=this.el,_.extend(this.settings,e.parent),this.router=e.parent.router,this.settings.collection&&this.settings.collection.bind("complete",this.query),HMSEvent.on("hms-show-mlsselector",this.render),this.query()},query:function(){this.collection.reset(),_.extend(this.collection.params,this.settings.model.attributes),this.collection.params.lsid=null,this.collection.params.Count=0,this.collection.params.facetpivot="listingsourceid,listingsourcename",this.collection.params.siteid=siteid,this.collection.bind("complete",this.load),this.collection.fetch()},load:function(e){var t=this;setTimeout(function(){var n=[],r="",i=t.settings.disclosureView.lsCollection,s="",o,u,a,f=[];if(i&&i.models){for(var l=0;l<i.models.length;l++)o=i.models[l].get("ListingSourceID"),u=i.models[l].get("DisplayName"),o=="0"&&(u="RE/MAX Listings"),r+=u,l<i.models.length-3?a=", ":l==i.models.length-2?a=" and ":a=", ",r+=a,f.push(o);r.length>0&&(r=r.substring(0,r.length-2)),_.each(e.models,function(e){o=e.get("Value"),o==0&&(e.attributes.Pivots[0].Value="RE/MAX Listings"),o!=undefined&&$.inArray(o,f)<0?n.push(e.toJSON()):o!=undefined&&$.inArray(o,f)>0&&(x.resultcountformatted==undefined&&(x.resultcountformatted=0),x.resultcountformatted=parseInt(x.resultcountformatted)+parseInt(e.attributes.Count))})}t.displayModel.OtherListingSources=n,t.displayModel.DisplayedListingSources=r,x.displaylistingsources=r;if(r!=""){var c=", listed with "+r;t.router&&t.router.searchView&&t.router.searchView.listingsdata&&(t.router.searchView.listingsdata.searchTitleListingSourceName=c),$(".js-searchTitleListingSourceName").replaceWith(c)}n.length>0&&HMSEvent.trigger("hms-mlsselector-ready")},1e3)},render:function(){HMSTemplate.get(m,this.renderCallback)},renderCallback:function(e){var t=e.render(this.displayModel);HMSEvent.trigger("ui-modal-open",{content:t}),this.setElement($("#js-modal-mlsselector"))},handleClick:function(e){e.preventDefault(),HMSEvent.trigger("ui-modal-close"),HMSEvent.trigger("hms-mlsselector-click",e)},store:{server:!0,ttl:3600,key:function(){return this.url()}}});var N=null;return h.AbortPending=function(){k()},p=h,p})