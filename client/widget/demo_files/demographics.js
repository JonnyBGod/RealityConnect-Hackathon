function isLoggedin(){return HMSUser&&!HMSUser.isLoggedout()?!0:!1}define(["backbonestore","templateEngine","hmsglobal","app/ui-modules/charts/hfcharts","text!templates/demographics/results-details-hfareainfo.html","text!templates/demographics/results-details-hfschools.html","text!templates/demographics/results-details-hfdemographics.html","text!templates/demographics/results-details-hfpublicinfo.html","text!templates/demographics/results-details-hfenviromental.html"],function(e,t,n,r,i,s,o,u,a){var f={},l={},c=Hogan.compile(i),h=Hogan.compile(s),p=Hogan.compile(o),d=Hogan.compile(u),v=Hogan.compile(a),m="text!templates/user/alternate-registration.html",g=!0,y=!1,b=!1,w=!1,E=!1,S=!1;return f.HomeFactsCollection=e.Collection.extend({name:"collection-homefacts",params:{SiteID:siteid,radius:5,lat:0,"long":0},url:function(){var e="/api/homefacts/?";return _.each(this.params,function(t,n){e+=n+"="+t+"&"}),e}}),f.HomeFacts=e.View.extend({el:"#js-HomeFacts",settings:{},name:"js-HomeFacts",HFCollection:{},events:{"click #js-schools-nearby-more":"onNearbySchoolsClick","click #js-a-more-schools":"onMoreSchoolsClick","click #js-a-more-education":"onMoreEducationClick","click #js-a-more-services":"onMoreServicesClick","click .js-hfdemographic-btn":"onCensusDataTabClick","click .js-hfpublicinfo-btn":"onPublicInfoTabClick","click .js-hfenviroment-btn":"onEnviromentTabClick"},initialize:function(e){_.extend(this.settings,e),_.bindAll(this,"render","onNearbySchoolsClick","onMoreSchoolsClick","onMoreEducationClick","onMoreServicesClick","onCensusDataTabClick","onPublicInfoTabClick","onEnviromentTabClick","demographicDefault","hfPublicInfo","hfCensusData","hfEnviroment"),HMSEvent.on("onUserReady",this.frameworkCheck,this),HMSEvent.on("onUserLoggedOut",this.userLoggedOut,this),HMSEvent.on("onFrameWorkFunctionCallBack",this.frameworkCallback,this),this.settings&&!this.settings.isForeclosure&&(this.plotHFCharts=new r.View),this.demographicDefault(0)},onNearbySchoolsClick:function(e){if(!isLoggedin()&&g&&!b){var t=parseInt($.cookie("ldpCount")),n=[];n.callback=this.onNearbySchoolsClick,n.arg=e,$("#js-schools-nearby-more").show(),$("#js-schools_nearby").hide(),y&&t%3==0&&t<=9&&(this.altRegModal||(this.altRegModal=new f.AltRegistrationModal(n)),this.altRegModal.showModal(n)),y&&t>9&&HMSEvent.trigger("user-show-register",{callback:this.onNearbySchoolsClick,args:e}),y||HMSEvent.trigger("user-show-register",{callback:this.onNearbySchoolsClick,args:e}),t%3!=0&&t<=9&&y&&($("#js-schools-nearby-more").hide(),$("#js-schools_nearby").show())}else $("#js-schools-nearby-more").hide(),$("#js-schools_nearby").show()},frameworkCallback:function(e){$("#js-schools-nearby-more").hide(),$("#js-schools_nearby").show(),b=!0},userLoggedOut:function(){g&&($("#js-schools-nearby-more").show(),$("#js-schools_nearby").hide())},frameworkCheck:function(){if(HMSUser){var e=HMSUser.model.get("registrationSwitch");e.C6?g=!0:g=!1,e.E1&&(y=!0)}},onMoreSchoolsClick:function(){this.toggleViewMoreDisplay()},toggleViewMoreDisplay:function(){w?($(".js-more-schools").addClass("hidden"),$("#js-a-more-schools span.icon").removeClass("active"),w=!1):($(".js-more-schools").removeClass("hidden"),$("#js-a-more-schools span.icon").addClass("active"),w=!0),HMSEvent.trigger("ui-update-classes")},onMoreEducationClick:function(){this.toggleViewMoreEducation(),S&&this.toggleViewMoreServices()},toggleViewMoreEducation:function(){E?($(".js-more-education").addClass("hidden"),$("#js-a-more-education span.icon").removeClass("active"),E=!1):($(".js-more-education").removeClass("hidden"),$("#js-a-more-education span.icon").addClass("active"),E=!0),HMSEvent.trigger("ui-update-classes")},onMoreServicesClick:function(){this.toggleViewMoreServices(),E&&this.toggleViewMoreEducation()},onCensusDataTabClick:function(e){if(!$(e.currentTarget).hasClass("active")){var t=$(".js-hfdemographic-btn"),n="#js-"+e.target.getAttribute("data-tab").toLowerCase().trim()+"-tab";$.each($(".js-hfdemographic-btn"),function(e,t){$(this).removeClass("active"),$(this).parent().find(".js-hfarrow").addClass("hidden")}),$.each($(".js-hfdemographic-tab"),function(e,t){$(this).addClass("hidden")}),$(e.currentTarget).addClass("active"),$(e.currentTarget).parent().find(".js-hfarrow").removeClass("hidden"),$(n).removeClass("hidden"),this.plotHFCharts&&this.plotHFCharts.reloadChart("pie")}},onEnviromentTabClick:function(e){if(!$(e.currentTarget).hasClass("active")){var t=$(".js-hfenviroment-btn"),n="#js-"+e.target.getAttribute("data-tab").toLowerCase().trim()+"-tab";$.each($(".js-hfenviroment-btn"),function(e,t){$(this).removeClass("active"),$(this).parent().find(".js-hfarrow").addClass("hidden")}),$.each($(".js-hfenviroment-tab"),function(e,t){$(this).addClass("hidden")}),$(e.currentTarget).addClass("active"),$(e.currentTarget).parent().find(".js-hfarrow").removeClass("hidden"),$(n).removeClass("hidden")}},onPublicInfoTabClick:function(e){if(!$(e.currentTarget).hasClass("active")){var t=$(".js-hfpublicinfo-btn"),n="#js-"+e.target.getAttribute("data-tab").toLowerCase().trim()+"-tab";$.each($(".js-hfpublicinfo-btn"),function(e,t){$(this).removeClass("active"),$(this).parent().find(".js-hfarrow").addClass("hidden")}),$.each($(".js-hfpublicinfo-tab"),function(e,t){$(this).addClass("hidden")}),$(e.currentTarget).addClass("active"),$(e.currentTarget).parent().find(".js-hfarrow").removeClass("hidden"),$(n).removeClass("hidden"),this.plotHFCharts&&this.plotHFCharts.reloadChart("line")}},demographicDefault:function(e){this.hfCensusData(e),this.hfPublicInfo(e),this.hfEnviroment(e)},hfCensusData:function(e){var t=$(".js-hfdemographic-btn")[e],n=$("#js-"+$(t).data("tab")+"-tab");$.each($(".js-hfdemographic-btn"),function(e,t){$(this).removeClass("active"),$(this).parent().find(".js-hfarrow").addClass("hidden")}),$.each($(".js-hfdemographic-tab"),function(e,t){$(this).addClass("hidden")}),$(t).addClass("active"),$(t).parent().find(".js-hfarrow").removeClass("hidden"),$(n).removeClass("hidden")},hfPublicInfo:function(e){var t=$(".js-hfpublicinfo-btn")[e],n=$("#js-"+$(t).data("tab")+"-tab");$.each($(".js-hfpublicinfo-btn"),function(e,t){$(this).removeClass("active"),$(this).parent().find(".js-hfarrow").addClass("hidden")}),$.each($(".js-hfpublicinfo-tab"),function(e,t){$(this).addClass("hidden")}),$(t).addClass("active"),$(t).parent().find(".js-hfarrow").removeClass("hidden"),$(n).removeClass("hidden")},hfEnviroment:function(e){var t=$(".js-hfenviroment-btn")[e],n=$("#js-"+$(t).data("tab")+"-tab");$.each($(".js-hfenviroment-btn"),function(e,t){$(this).removeClass("active"),$(this).parent().find(".js-hfarrow").addClass("hidden")}),$.each($(".js-hfenviroment-tab"),function(e,t){$(this).addClass("hidden")}),$(t).addClass("active"),$(t).parent().find(".js-hfarrow").removeClass("hidden"),$(n).removeClass("hidden")},toggleViewMoreServices:function(){S?($(".js-more-services").addClass("hidden"),$("#js-a-more-services span.icon").removeClass("active"),S=!1):($(".js-more-services").removeClass("hidden"),$("#js-a-more-services span.icon").addClass("active"),S=!0),HMSEvent.trigger("ui-update-classes")},render:function(e){this.HFCollection=e;var t=parseInt($.cookie("ldpCount")),n="";b=!1,e.HFSchools&&e.HFSchools.length>0&&(n=h.render({HomeFacts:e})),$("#js-hfschools").html(n),e.HFMoreSchools.length>0&&$("#js-a-more-schools").show(),e.HFSchools.length>0&&this.applySchoolsRules(),n=c.render({HomeFacts:e}),$("#js-hfareainfo").replaceWith(n),n=d.render({HomeFacts:e}),$("#js-hfpublicinfo").replaceWith(n),n=v.render({HomeFacts:e}),$("#js-hfenviroment").replaceWith(n),n=p.render({HomeFacts:e}),$("#js-hfdemographics").html(n),this.setElement($(".js-homefacts")),this.plotHFCharts?this.plotHFCharts.getCharts():this.plotHFCharts=new r.View,this.demographicDefault(0)},applySchoolsRules:function(){!isLoggedin()&&g?_numCounter%3!=0&&_numCounter<=9&&y?($("#js-schools-nearby-more").hide(),$("#js-schools_nearby").show()):($("#js-schools-nearby-more").show(),$("#js-schools_nearby").hide()):($("#js-schools-nearby-more").hide(),$("#js-schools_nearby").show())}}),f.POICollection=e.Collection.extend({name:"collection-poi",params:{SiteID:siteid},url:function(){var e="/api/pois/?";return _.each(this.params,function(t,n){e+=n+"="+t+"&"}),e}}),f.AltRegistrationModal=e.View.extend({el:$("#js-modal-altregistration"),events:{"click .js-altregistration-close":"onAltregistrationClose","click .js-altregistration-submit":"onModalSubmit"},settings:{},initialize:function(e){_.extend(this.settings,e),_.bindAll(this,"renderCallback"),HMSEvent.on("onBeforeModalClose",this.onModalClose,this)},showModal:function(e){this.parent=e.parent,this.callBack=e.callback,this.arg=e.arg,this.render()},render:function(e){HMSTemplate.get(m,this.renderCallback)},renderCallback:function(e){var t="";t+=e.render(),HMSEvent.trigger("ui-modal-open",{content:t}),this.setElement($("#js-modal-altregistration"))},onModalSubmit:function(e){HMSEvent.trigger("user-show-register",{callback:this.callBack,args:this.arg})},onModalClose:function(e){e&&($(e.currentTarget).parents("#js-modal-altregistration").length>0?(b=!0,$("#js-schools-nearby-more").hide(),$("#js-schools_nearby").show(),HMSEvent.trigger("onFrameWorkFunctionCallBack",{framework:"schools"})):b=!1)},onAltregistrationClose:function(e){b=!0,$("#js-schools-nearby-more").hide(),$("#js-schools_nearby").show(),HMSEvent.trigger("onFrameWorkFunctionCallBack",{framework:"schools"}),HMSEvent.trigger("ui-modal-close")}}),l=f,l})