define(["backbonestore","app/models/search","microdata.json","templateEngine"],function(e,t,n){var r={},i={},s="text!templates/listings/disclosure.html";return r.Disclosure=e.View.extend({name:"js-detail-disclosure",el:$("[data-id='js-disclosure']"),settings:{},lsCollection:new t.ListingSources,initialize:function(e){var t="";_.bindAll(this,"render","getLSIDs","load","addLogos","addPocketLogos","renderCallback"),_.extend(this.settings,e),HMSEvent.on("js-detail-disclosure-addLogos",this.addLogos),HMSEvent.on("js-detail-disclosure-addPocket",this.addPocketLogos),this.settings.model?(t=this.settings.model.get("ListingSourceID"),this.settings.model.on("change",this.load)):this.settings.selector&&(t=this.getLSIDs(this.settings.selector)),this.get(t),this.settings.collection&&this.settings.collection.on("complete",this.load)},get:function(e){this.lsCollection.reset(),this.lsCollection.params.lsid=e,this.lsCollection.params.siteid=siteid,this.lsCollection.bind("complete",this.render),this.lsCollection.fetch()},load:function(e){e=e.toJSON();var t="";e&&(e.ListingSourceID?t=e.ListingSourceID:(_.each(e,function(e){e&&e.ListingSourceID&&t.indexOf(e.ListingSourceID)<0&&(t+=e.ListingSourceID+",")}),t.length>0&&(t=t.substring(0,t.length-1)))),this.get(t)},getLSIDs:function(e){var t="",r=$.parseJSON(n(e));return r.items&&_.each(r.items,function(e){t.indexOf(e.properties.ListingSourceID+",")<0&&(t+=e.properties.ListingSourceID+",")}),t.length>0&&(t=t.substring(0,t.length-1)),t},render:function(e){HMSTemplate.get(s,this.renderCallback)},renderCallback:function(e){var t=this.lsCollection.toJSON(),n="";return _.each(t,function(t){n+=e.render(t),n+=t.TermsOfUse}),$("[data-id='js-disclosure']").html(n),this},addPocketLogos:function(){var e=$("[data-id='listingLogo'][data-lsid='0']"),t="";_.each(e,function(e){e=$(e),t="",e.attr("data-luxury").toLowerCase()=="true"?t="/resources/images/luxury-logo.jpg":parseInt(e.attr("data-siteid"))>0&&(t="/resources/images/showcase-logo.jpg"),t!=""?e.attr("src",t):e.hide()})},addLogos:function(e){var t=$(e.IDXLogoReference).attr("src"),n="[data-id='listingLogo'][data-lsid='"+e.ListingSourceID+"']",r="",i=$(n);_.each(i,function(e){e=$(e),r="",e.attr("data-luxury").toLowerCase()=="true"?r="/resources/images/luxury-logo.jpg":parseInt(e.attr("data-siteid"))>0?r="/resources/images/showcase-logo.jpg":t?(clsName="idxlogo",e.attr("src",t)):e.hide(),r!=""&&e.attr("src",r)})}}),i=r,i})