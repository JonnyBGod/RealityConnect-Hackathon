function isLoggedin(){return HMSUser&&!HMSUser.isLoggedout()?!0:!1}define(["backbonestore","./searchresults","./results","./mapview","app/ui-modules/paging/pager"],function(e,t,n,r,i){exports={},window.arrPending=[];var s=e.Router.extend({settings:{},name:"js-searchresultspage-router",routes:{"search/*path":"execSearch"},initialize:function(e){_.bindAll(this,"execSearch","searchComplete","searchFail","listSearch","foreclosuresSearch","foreclosuresSearchComplete","recentSearch","mapSearch","renderComplete","pageTo","trackSearch"),_.extend(this.settings,e),this.searchResultsPageView=new t.SearchResultsPage(this),this.messageView=new t.Message(this),this.searchView=new t.Search(this),this.tabsView=new n.Tabs(this),this.resultsView=new n.List(this),this.searchViewPager=new i.List(this.resultsView),this.recentSalesView=new n.RecentSales(this),this.recentSalesViewPager=new i.List(this.recentSalesView),this.foreclosuresView=new n.Foreclosures(this),this.foreclosuresViewPager=new i.List(this.foreclosuresView),this.mapView=new r.Map(this),HMSEvent.on(this.searchViewPager.pageEventName(),this.pageTo),HMSEvent.on(this.recentSalesViewPager.pageEventName(),this.pageTo),HMSEvent.on(this.foreclosuresViewPager.pageEventName(),this.pageTo),HMSEvent.on(this.name+"-render-complete",this.renderComplete),HMSEvent.on("onUserReady",this.callPending,this),this.isUserReady=!1,this.pending={},this.pending.recent=!1;var s=!1;this.tabsView.active=="map"?($("#js-search-results-sort").hide(),this.searchResultsPageView.model.set("tab","map"),this.execSearch()):this.tabsView.active=="recent"?$("#js-refinesearch-propertytype").hide():this.tabsView.active=="foreclosures"&&(s=!0),this.searchView.updateRefineSearch({ForeclosuresHeader:s})},pageTo:function(e){this.searchResultsPageView.pageRoute(e)},execSearch:function(e){var t;if(e){var r=e.split("/");r&&r.length>0&&$.each(r,function(e,n){if(n){var r=n.split("-");r&&r[0]=="tab"&&(t=r[1])}})}n.AbortPending(),this.searchView.closeDropdowns(),this.searchResultsPageView.block(),t||(t=this.searchResultsPageView.model.get("tab")),t&&this[t+"Search"].apply(this),HMSEvent.trigger("user-update-savedsearch")},listSearch:function(){_.extend(this.searchResultsPageView.collection.params,this.searchResultsPageView.model.attributes);var e=this.searchResultsPageView.model.toJSON();e.ForSaleHeader=!0,e.searchLocation=e.location,this.searchView.updateHeaderResults(e),this.searchView.updateRefineSearch(e),this.searchResultsPageView.collection.reset();var t=this.searchResultsPageView.collection.fetch({success:this.searchComplete,error:this.searchFail});arrPending.push(t),HMSEvent.trigger("TrackRemarketing")},foreclosuresSearch:function(){_.extend(this.foreclosuresView.collection.params,this.searchResultsPageView.model.attributes);var e=this.searchResultsPageView.model.toJSON();e.ForeclosuresHeader=!0,e.searchLocation=e.location,this.searchView.updateHeaderResults(e),this.searchView.updateRefineSearch(e),this.foreclosuresView.collection.reset();var t=this.foreclosuresView.collection.fetch({success:this.foreclosuresSearchComplete,error:this.searchFail})},foreclosuresSearchComplete:function(e,t){e.reset(),_.each(t[0],function(t){e.add(t)}),this.foreclosuresView.collection.trigger("complete",e)},recentSearch:function(){if(this.isUserReady){var e=this.searchResultsPageView.model.toJSON();e.RecentHeader=!0,e.searchLocation=e.location,this.searchView.updateHeaderResults(e),this.searchView.updateRefineSearch(e),this.recentSalesView.collection.reset(),this.recentSalesView.show(this.searchResultsPageView.model)}else this.pending.recent=!0},mapSearch:function(){_.extend(this.mapView.collection.params,this.searchResultsPageView.model.attributes);var e=this.searchResultsPageView.model.toJSON();e.ForSaleHeader=!0,e.searchLocation=e.location,this.searchView.updateHeaderResults(e),this.searchView.updateRefineSearch(e),this.mapView.collection.reset(),this.mapView.show(this.searchResultsPageView.model)},searchComplete:function(e,t){e.reset(),_.each(t[0],function(t){e.add(t)}),this.searchResultsPageView.collection.trigger("complete",e),this.trackSearch(this.searchResultsPageView.model,e)},searchFail:function(e,t){},renderComplete:function(){this.searchResultsPageView.unblock()},trackSearch:function(e,t){var n={},r,i;r=e.attributes.location,n.Location=r,n.LSID=t.metadata.searchdescriptiondata.ListingSourceID,n.SearchResultHost=t.metadata.searchdescriptiondata.SearchResultHost,n.tabClick=this.tabClick,HMSEvent.trigger("TrackSearch",n),this.tabClick=!1},callPending:function(){this.isUserReady=!0,this.pending.recent&&this.recentSearch()}}),o=null;return exports.execute=function(t){o||(e.history.clean(),o=new s(t),e.history.restart())},exports.getActiveTab=function(){var e="";return o&&(e=o.tabsView.active),e},exports.IsForeclosureTabActiveOnMap=function(){var e=!1;return o&&o.tabsView&&o.tabsView.active=="map"&&o.mapView&&o.mapView.activeLayer=="foreclosuresClusteredLayer"&&(e=!0),e},exports})