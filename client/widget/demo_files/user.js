define(["backbonestore","app/mediators/form","app/models/user","text!templates/user/navbar.html","hmsglobal","app/ui-modules/slider/slider","app/searchresults/router","Tea","innershiv","app/mediators/ui"],function(e,t,n,r,i,s,o){function T(e,t){var n=+(new Date),r=Math.abs(t-n)/1e3;return r>e.ttl&&e.ttl>0||e.destroy?!0:!1}function N(e,t){var n,r="";n=e.toLowerCase(),r=t.toLowerCase(),n.indexOf("?")==0&&(n=n.substring(1,n.length)),r.indexOf("?")==0&&(r=r.substring(1,r.length));var i=n.split("&");i=i.sort();var s={};$.each(i,function(e,t){ps=t.split("="),k=ps[0],v=ps[1],k1st=k.substring(0,1),k2nd=k.substring(1,2),ki=k.substring(2),s[k1st+ki]||(s[k1st+ki]="");if(k1st=="q"&&(k2nd=="f"||k2nd=="v")||k1st=="o")s[k1st+ki]+=v});var o=r.split("&");o=o.sort();var u={};$.each(o,function(e,t){ps=t.split("="),k=ps[0],v=ps[1],k1st=k.substring(0,1),k2nd=k.substring(1,2),ki=k.substring(2),u[k1st+ki]||(u[k1st+ki]="");if(k1st=="q"&&(k2nd=="f"||k2nd=="v")||k1st=="o")u[k1st+ki]+=v});var a=!1;return $.each(s,function(e,t){var n=!1;!t.indexOf("pagenumber")==0&&!t.indexOf("count")==0&&($.each(u,function(e,r){t==r&&(n=!0)}),n||(a=!0)),n=!1}),a||$.each(u,function(e,t){var n=!1;!t.indexOf("pagenumber")==0&&!t.indexOf("count")==0&&($.each(s,function(e,r){r==t&&(n=!0)}),n||(a=!0)),n=!1}),!a}var u={},a={},f=!1,l=[];_showABTesting=!1,pwd="l0g1nR3m3mb3r";var c=Hogan.compile(r),h="text!templates/user/login.html",p="text!templates/user/modal-forgotpassword.html",d="text!templates/user/register.html",m="text!templates/user/header-loggedin.html",g="text!templates/user/header-loggedout.html",y="text!templates/user/header-savedlistings.html",b="text!templates/user/header-savedsearches.html",w="text!templates/user/modal-savelisting.html",E="text!templates/user/modal-savesearch.html",S="text!templates/user/foreclosure.html",x="text!templates/user/more-info-social.html";return u.Details=e.View.extend({el:"body",settings:{showsearch:!0},events:{"click .js-user-login":"showLogin","click .js-user-register":"showRegister","click .js-user-forgotpassword":"showForgotPassword","click .js-user-logout":"doLogout","click .js-user-savelisting":"saveListing","click .js-user-setlistingalert":"saveListing","click .js-user-listingalertset":"saveListing","click .js-user-removelisting":"removeListing","click .js-user-savesearch":"saveSearch","click .js-user-setsearchalert":"saveSearch","click .js-user-searchalertset":"saveSearch","click .js-user-removesearch":"removeSearch","click .js-user-hidelisting":"hideListing","click .js-user-listinghidden":"unhideListing","click [data-id='js-social-login']":"showSocialLogin"},isFSignupSuccess:!1,model:new n.User,initialize:function(e){this.isUserReady=!1,_.extend(this.settings,e),_.bindAll(this,"render","updateStatus","updateStatusCallback","updateNavSavedListings","updateNavSavedSearches","updateNavSavedListingsCallback","updateNavSavedSearchesCallback","checkLoggedIn","saveListing","loginFailure","registerFailure","showLogin","showRegister","showSocialLogin","showForgotPassword","showForeclosure","foreclosureEventListener","modalCloseChecker"),this.render();var t=$.cookie("testingframeworkinfo")||"";l=t.split(","),$.log(l),e.registrationSwitch={B1:this.searchArry("B1"),C1:this.searchArry("C1"),C2:this.searchArry("C2"),C3:this.searchArry("C3"),C4:this.searchArry("C4"),C5:this.searchArry("C5"),C6:this.searchArry("C6"),D1:this.searchArry("D1"),E1:this.searchArry("E1"),E2:this.searchArry("E2"),F1:this.searchArry("F1")},f=e.registrationSwitch.D1,_showABTesting=e.registrationSwitch.F1,e.registrationSwitch&&this.model.set({registrationSwitch:e.registrationSwitch}),this.model.on("change:userId",this.updateStatus),this.model.on("change:loginFailure",this.loginFailure),this.model.on("change:registerFailure",this.registerFailure),this.model.on("change:slalerts",this.updateSavedListings),this.model.on("change:savedlistingsCount",this.updateSavedListingsCount),this.model.on("change:hlids",this.updateHiddenListings),this.model.on("change:savedlistings",this.updateNavSavedListings),this.model.on("change:savedsearches",this.updateNavSavedSearches),this.model.on("change:searchcookie",this.updateSavedSearches),this.model.on("change:ssalerts",this.updateSavedSearches),this.model.on("change:savedsearchesCount",this.updateSavedSearchesCount),this.model.on("change:firstName",this.updateFirstName),this.model.getUser(this.checkLoggedIn),HMSEvent.on("user-show-login",this.showLogin),HMSEvent.on("user-show-register",this.showRegister),HMSEvent.on("user-show-forgotpassword",this.showForgotPassword),HMSEvent.on("user-show-foreclosure",this.showForeclosure),HMSEvent.on("user-show-twitter-email",this.showMoreSocialInfo),HMSEvent.on("onPropertyBlockReady",this.reTriggerOnUserReady),HMSEvent.on("onSavedListingsReady",this.reTriggerOnUserReady),HMSEvent.on("onSavedSearchesReady",this.reTriggerOnUserReady),HMSEvent.on("onAccountSettingsReady",this.reTriggerOnUserReady),HMSEvent.on("onLeadCaptureReady",this.reTriggerOnUserReady),HMSEvent.on("onShareReady",this.reTriggerOnUserReady),HMSEvent.on("onItemClickedReady",this.reTriggerOnUserReady),HMSEvent.on("onListingDetailInitialized",this.reTriggerOnUserReady),HMSEvent.on("onListingDetailRouterInitialized",this.reTriggerOnUserReady),HMSEvent.on("onAfterModalClose",this.modalCloseChecker),$(this.el).bind("click",function(e){$("ul#js-user-acctmenu li.dropdown").removeClass("open")}),HMSEvent.trigger("ui-update-share")},searchArry:function(e){var t=!1;if(l.length>0)for(var n=0;n<l.length;n++)l[n]===e&&(t=!0);return t},setDelegation:function(){this.setElement(this.el)},render:function(){var t=c.render();$("#js-user")==undefined?setTimeout(function(){$("#js-user").replaceWith(t)},1e3):$("#js-user").replaceWith(t),this.settings.showsearch||$("#js-user-propsearch").remove()},isLoggedout:function(){return this.model?this.model.isLoggedout():!1},reTriggerOnUserReady:function(){HMSUser&&HMSUser.model&&HMSUser.model.attributes&&HMSUser.model.attributes.userId&&HMSEvent.trigger("onUserReady")},updateStatus:function(t){t.isLoggedout()?HMSTemplate.get(g,this.updateStatusCallback):HMSTemplate.get(m,this.updateStatusCallback)},updateStatusCallback:function(e){var t=this.model.toJSON(),n="";if(this.model.isLoggedout())n=e.render(),this.model.get("userId")!=null&&this.model.get("userId")=="loggedout"&&HMSEvent.trigger("onUserLoggedOut");else{if($("#js-user-acctmenu a").length>0){var r="";t.action&&(r=t.message),HMSEvent.trigger("user-refresh-hidelisting"),HMSEvent.trigger("onUserLoggedIn")}t&&t.firstName&&(t.firstName=t.firstName.split(" ")[0]),t&&t.photo==""&&(t.photo=null),t&&t.savedsearchesCount==0&&(t.savedsearchesCount=null),t&&t.savedlistingsCount==0&&(t.savedlistingsCount=null),n=e.render(t)}$("#js-user-acctmenu").replaceWith(n),HMSEvent.trigger("user-update-savedlistings"),HMSEvent.trigger("user-update-savedsearch")},checkLoggedIn:function(t){var n=null,r=!0;t&&t.data&&(r=T(t.data,t.data.timestamp),t.data.value&&(n=t.data.value)),!r&&n&&n.userId&&!isNaN(n.userId)?this.model.set(n):this.login=new u.Login(this.settings)},updateFirstName:function(e,t){t&&(t=t.split(" ")[0],$(".js-user-firstname").html(t))},saveListing:function(e){e.preventDefault();if(HMSUser.isUserReady){var t=$(e.currentTarget),r=null,i=e.currentTarget.className.indexOf("js-user-setlistingalert")!=-1,s=e.currentTarget.className.indexOf("js-user-listingalertset")!=-1,o=!i&&!s,a=null;a=t.data("listingid"),!a&&a!=0&&(a=t.parent().data("listingid")),!a&&a!=0&&(a=t.parent().parent().data("listingid"));if(a==0){var f=$(".js-listitem");f.length>0&&(r=new n.SavedListing({setalert:i,removealert:s,nonsetalert:o},{siteid:"68000000"}),r.loadFromMData({el:f}),a=r.get("HVListingID"),r.set("ListingID",a),r.set("SavedListingTypeID",160))}var l=null;l=t.data("savedlistingid"),l||(l=t.parent().data("savedlistingid")),l||(l=t.parent().parent().data("savedlistingid")),a&&!l&&!HMSUser.isLoggedout()&&(l=HMSUser.model.attributes.slids[a]);if(a&&!isNaN(a)){var f=$(".js-listitem[data-listingid="+a+"]");f.length>0&&(r=new n.SavedListing({setalert:i,removealert:s,nonsetalert:o},{siteid:"68000000"}),r.loadFromMData({el:f})),l&&r&&(r.set("SavedListingID",l),r.set("action","savestatusalert")),r&&(HMSUser.isLoggedout()?(HMSUser.register||(HMSUser.register=new u.Register(HMSUser.settings)),r.attributes.action="savelisting",i&&r.set("StatusAlert",!0),HMSUser.register.render(r.toJSON())):(HMSUser.savelisting||(HMSUser.savelisting=new u.SaveListing),HMSUser.savelisting.render(r.toJSON())))}}},removeListing:function(e){e.preventDefault();if(HMSUser.isUserReady){var t=$(e.currentTarget),r=t.data("savedlistingid"),i=$(".js-listitem[data-savedlistingid="+r+"]");i.length>0&&$(".js-user-removelisting[data-savedlistingid="+r+"]").enConfirm({callback:function(){slModel=new n.SavedListing(null,{siteid:"68000000",SavedListingID:r}),slModel.loadFromMData({el:i}),slModel.id=r,slModel.destroy({success:function(e,t){e.set(t),HMSUser.removeSavedListing(e)}})},showDontAskAgain:!1,skipConfirmation:!0})}},saveSearch:function(e){e.preventDefault();if(HMSUser.isUserReady){var t=$(e.currentTarget),r=null;r=t.data("savedsearchid"),r||(r=t.parent().data("savedsearchid")),r||(r=t.parent().parent().data("savedsearchid"));var s=e.currentTarget.className.indexOf("js-user-setsearchalert")!=-1,o=e.currentTarget.className.indexOf("js-user-searchalertset")!=-1,a=!o&&!s,f=null;if(r&&!isNaN(r))f=new n.SavedSearch({SavedSearchID:r,setalert:s,updatealert:o,nonsetalert:a},{siteid:"68000000"}),this.savesearch||(this.savesearch=new u.SaveSearch),this.savesearch.render(f.toJSON());else{var l=null,c;HMSUser.isHomeValueSearch()||HMSUser.isRecentSalesSearch()?c="g_strLastHomeValueSearch":c="g_strLastSearch",l=$.cookie(c);if(l&&l.length>0){var h=l.substring(1,l.length);f=new n.SavedSearch({SearchQueryString:h,setalert:s,updatealert:o,nonsetalert:a},{siteid:"68000000"});var p=i.SavedSearchTypes.SimpleSearch;HMSUser.isHomeValueSearch()&&(p=i.SavedSearchTypes.HomeValues),HMSUser.isRecentSalesSearch()&&(p=i.SavedSearchTypes.RecentSales),HMSUser.isForeclosureSearch()&&(p=i.SavedSearchTypes.Foreclosure),f.set("SavedSearchesTypeID",p),this.isLoggedout()?(this.register||(this.register=new u.Register(this.settings)),f.attributes.action="savesearch",s&&(f.set("SimilarHomesAlert",!0),f.set("AlertFrequency","daily")),this.register.render(f.toJSON())):(this.savesearch||(this.savesearch=new u.SaveSearch),this.savesearch.render(f.toJSON()))}}}},removeSearch:function(e){e.preventDefault();if(HMSUser.isUserReady){var t=$(e.currentTarget),r=t.data("savedsearchid");r||(r=t.parent().data("savedsearchid")),r||(r=t.parent().parent().data("savedsearchid"));var i=$(".js-searchitem[data-savedsearchid="+r+"]");i.length>0&&$(".js-user-removesearch[data-savedsearchid="+r+"]").enConfirm({callback:function(){slModel=new n.SavedSearch(null,{siteid:"68000000",SavedSearchID:r}),slModel.loadFromMData({el:i}),slModel.id=r,slModel.destroy({success:function(e,t){e.set(t),HMSUser.removeSavedSearch(e)}})},showDontAskAgain:!1,skipConfirmation:!0})}},loginFailure:function(t){t.attributes.loginFailure&&(HMSEvent.trigger("ui-notify",{msg:"Sorry - we couldn't find your account with that email and password. Please check your entry and try again. Remember - passwords are <b>case sensitive</b>.",mode:"inline",selector:"#js-errormessage-login"}),this.model.attributes.loginFailure=!1)},registerFailure:function(t){t.attributes.registerFailure&&(HMSEvent.trigger("ui-notify",{msg:t.get("message"),mode:"inline",selector:"#js-errormessage-register"}),this.model.attributes.registerFailure=!1)},doLogout:function(){var t=new n.LogoutModel({siteid:"68000000"});t.fetch({success:function(e){e.attributes.success&&(HMSUser.model.setDefaults(),HMSUser.model.set({userId:"loggedout"}),e.attributes.success||HMSEvent.trigger("ui-notify",{msg:"You have been successfully logged out."}),HMSEvent.trigger("ui-show-agentbranding",{forceagentbranding:!0}),window.location.pathname.indexOf("/myremax/")!=-1?window.location.href="/":(HMSUser.model.set("isForeclosureAuth",!1),HMSEvent.trigger("user-update-savedlistings"),HMSEvent.trigger("user-update-savedsearch"),HMSEvent.trigger("user-refresh-hidelisting"),HMSUser.model.get("foreclosureAuthentication").UserToken.length>0&&HMSEvent.trigger("user-foreclosure-logout")))}})},showLogin:function(n){if(this.isLoggedout()){var r=null;if(n&&n.type=="click"){n.preventDefault();var i=$(n.currentTarget);i.data("data")&&(r=i.data("data"))}r||(r={}),n&&n.callback&&(r.callback=n.callback),n&&n.args&&(r.args=n.args);var s=new e.Model;s.loadFromMData({el:".js-listitem"}),n&&n.IsForeclosure&&(r.IsForeclosure=n.IsForeclosure),$.cookie("g_strLastLocation")&&(r.Location=$.cookie("g_strLastLocation")),this.login||(this.login=new u.Login(this.settings)),this.login.render(r)}},showRegister:function(n){if(this.isLoggedout()){var r=null;if(n&&n.type=="click"){n.preventDefault();var i=$(n.currentTarget);i.data("data")&&(r=i.data("data"))}r||(r={}),n&&n.action&&(r.action=n.action),n&&n.ListingID&&(r.ListingID=n.ListingID),n&&n.callback&&(r.callback=n.callback),n&&n.args&&(r.args=n.args);var s=new e.Model;s.loadFromMData({el:".js-listitem"}),n&&n.IsForeclosure&&(r.IsForeclosure=n.IsForeclosure),$.cookie("g_strLastLocation")&&(r.Location=$.cookie("g_strLastLocation")),this.register||(this.register=new u.Register(this.settings)),this.register.render(r)}},showForgotPassword:function(t){this.isLoggedout()&&(t&&t.type=="click"&&t.preventDefault(),this.forgotpassword||(this.forgotpassword=new u.ForgotPassword(this.settings)),this.forgotpassword.render())},showForeclosure:function(t){if(this.isLoggedout())HMSEvent.trigger("user-show-login");else if(HMSUser&&HMSUser.model&&HMSUser.model.get("foreclosureAuthentication")){var r=HMSUser.model.get("foreclosureAuthentication");if(r.UserExists&&r.UserToken.length>0)HMSUser.model.set("isForeclosureAuth",!0),HMSEvent.trigger("user-foreclosure-reloadpage"),$.log("showForeclosure");else if(!r.UserExists){var i=HMSTrackingVars.PageName,s=HMSUser.model.get("email"),o=HMSUser.model.get("firstName")+" "+HMSUser.model.get("lastName"),u=(HMSUser.model.get("phone")||"").replace(/\D/g,""),a=new n.ForeclosureAuth({email:s,name:o,phone:u,action:"create"});a.fetch({success:function(e,t){HMSUser.model.set("foreclosureAuthentication",t),HMSEvent.trigger("user-show-foreclosure")},error:function(){}})}else{this.foreclosureEventListener();var f=this;setTimeout(function(){HMSTemplate.get(S,f.foreclosureRenderCallback)},1e3)}}},foreclosureRenderCallback:function(e){var t=HMSUser.model.get("foreclosureAuthentication"),n=e.render(t);HMSEvent.trigger("ui-modal-open",{content:n})},foreclosureEventListener:function(){var e=window.addEventListener?"addEventListener":"attachEvent",t=window[e],n=this,r=e=="attachEvent"?"onmessage":"message";t(r,function(e){$.log(e.data);var t=e.data;t=="SuccessLogin"||t=="SuccessSignUp"?(HMSUser.model.set("isForeclosureAuth",!0),n.isFSignupSuccess=!0):HMSUser.model.set("isForeclosureAuth",!1)},!1)},modalCloseChecker:function(){var e=HMSTrackingVars.PageName,t=this;if(e=="Property Search Results"||e=="Foreclosure Details"){var r=HMSUser.model.get("email"),i=HMSUser.model.get("firstName")+" "+HMSUser.model.get("lastName"),s=(HMSUser.model.get("phone")||"").replace(/\D/g,""),o=new n.ForeclosureAuth({email:r,name:i,phone:s,action:"auth"});o.fetch({success:function(e,n){HMSUser.model.set("foreclosureAuthentication",n);var r=HMSUser.model.get("foreclosureAuthentication");r.UserExists&&r.UserToken.length>0&&t.isFSignupSuccess&&(HMSUser.model.set("isForeclosureAuth",!0),HMSEvent.trigger("user-foreclosure-reloadpage"),t.isFSignupSuccess=!1,$.log("modalCloseChecker"))},error:function(){}})}},updateSavedListings:function(){$(".js-user-listingsaved").each(function(e,t){$(t).removeClass("js-user-listingsaved").addClass("js-user-savelisting"),$(t).find(".icon").removeClass("active");var n=$(t).find(".js-icontext");n.length>0?n.html("Save"):$(t).html("Save")}),$(".js-user-listingalertset").each(function(e,t){$(t).removeClass("js-user-listingalertset").addClass("js-user-setlistingalert"),$(t).find(".icon").removeClass("active");var n=$(t).find(".js-icontext");n.length>0?n.html("Alerts"):$(t).html("Alerts"),$(t).data("listingalert")=="pricehistory"&&$(t).html("Get price alerts on price change")});if(!HMSUser.isLoggedout()){var e=[],t=[],r=[],i=[];$.each(HMSUser.model.get("slalerts"),function(t,n){e.push(parseInt(t)),i.push(n)}),e.length>0&&($(".js-user-savelisting").each(function(t,r){var s=$(r).data("listingid");s||(s=$(r).parent().data("listingid")),s||(s=$(r).parent().parent().data("listingid"));if(s==0){var o=$(".js-listitem");slModel=new n.SavedListing({},{siteid:"68000000"}),slModel.loadFromMData({el:o}),s=parseInt(slModel.get("HVListingID")),s>0&&$(".js-iconsgrid").attr("data-listingid",s)}var u=$.inArray(s,e);if(u!=-1){$(r).removeClass("js-user-savelisting").addClass("js-user-listingsaved"),$(r).find(".icon").addClass("active");var a=$(r).find(".js-icontext");a.length>0?a.html("Saved"):$(r).html("Saved");if(i[u].toLowerCase()=="true"){var f=$(".js-iconsgrid[data-listingid="+s+"] .js-user-setlistingalert");f.removeClass("js-user-setlistingalert").addClass("js-user-listingalertset"),f.find(".icon").addClass("active");var l=f.find(".js-icontext");l.length>0?l.html("Edit alert"):f.html("Edit alert")}}}),$(".js-listitem").each(function(t,r){var s=$(r).data("listingid");if(s==0){var o=$(r);slModel=new n.SavedListing({},{siteid:"68000000"}),slModel.loadFromMData({el:o}),s=parseInt(slModel.get("HVListingID"))}var u=$.inArray(s,e);if(u!=-1&&i[u].toLowerCase()=="true"){var a=$(".js-listitem[data-listingid="+s+"] .js-user-setlistingalert");a.removeClass("js-user-setlistingalert").addClass("js-user-listingalertset"),a.find(".icon").addClass("active");var f=a.find(".js-icontext");f.length>0?f.html("Edit alert"):a.html("Edit alert")}})),HMSUser.model.set("savedlistingsCount",e.length)}HMSEvent.trigger("ui-update-classes")},updateHiddenListings:function(){$(".js-user-listinghidden").each(function(e,t){$(t).removeClass("js-user-listinghidden").addClass("js-user-hidelisting").removeClass("active"),$(t).find(".icon").removeClass("active");var n=$(t).find(".js-icontext");n.length>0?n.html("Hide"):$(t).html("Hide")});if(!HMSUser.isLoggedout()){var e=[];this.model&&this.model.attributes&&this.model.attributes.hlids&&(e=this.model.attributes.hlids),e.length==0&&HMSUser&&HMSUser.model&&HMSUser.model.attributes&&HMSUser.model.attributes.hlids&&(e=HMSUser.model.attributes.hlids),e.length>0&&$(".js-user-hidelisting").each(function(t,r){var i=$(r).data("listingid");i||(i=$(r).parent().data("listingid")),i||(i=$(r).parent().parent().data("listingid"));if(i==0){var s=$(".js-listitem");slModel=new n.HideListing({},{siteid:"68000000"}),slModel.loadFromMData({el:s}),i=parseInt(slModel.get("HVListingID"))}var o=$.inArray(i,e);if(o!=-1){$(r).removeClass("js-user-hidelisting").addClass("js-user-listinghidden").addClass("active"),$(r).find(".icon").addClass("active");var u=$(r).find(".js-icontext");u.length>0?u.html("Unhide"):$(r).html("Unhide")}})}HMSEvent.trigger("ui-update-classes")},removeSavedListing:function(e){e.attributes.success&&(this.model.set("savedlistings",e.attributes.savedlistings),this.model.set("slids",e.attributes.slids),this.model.set("sllistingsourceids",e.attributes.sllistingsourceids),this.model.set("slalerts",e.attributes.slalerts),this.model.set("hlids",e.attributes.hlids),HMSEvent.trigger("user-refresh-savedlistings",{refresh:!0}))},updateSavedListingsCount:function(){var e="";HMSUser.model.get("savedlistingsCount")>0&&(e="("+HMSUser.model.get("savedlistingsCount")+")"),$(".js-savedlistings-count").html(e)},updateNavSavedListings:function(e){HMSTemplate.get(y,this.updateNavSavedListingsCallback)},updateNavSavedListingsCallback:function(e){var t=this.model,n=e.render(t.toJSON());$("#js-user-savedlistings").replaceWith(n),HMSEvent.trigger("ui-prepare-detaillink")},updateNavSavedSearches:function(e){HMSTemplate.get(b,this.updateNavSavedSearchesCallback)},updateNavSavedSearchesCallback:function(e){var t=this.model;t&&$.each(t.attributes.savedsearches,function(e,t){t.Zip==""&&(t.Zip=null),t.ListingTypes==""&&(t.ListingTypes=null),t.PriceRangeDesc==""&&(t.PriceRangeDesc=null),t.BedBathDesc==""&&(t.BedBathDesc=null),t.CityStateDesc==""&&(t.CityStateDesc=null),t.NeighborhoodStateDesc==""&&(t.NeighborhoodStateDesc=null),t.CountyStateDesc==""&&(t.CountyStateDesc=null)});var n=e.render(t.toJSON());$("#js-user-savedsearches").replaceWith(n)},updateSavedSearches:function(){$(".js-user-searchsaved").each(function(e,t){$(t).removeClass("js-user-searchsaved").addClass("js-user-savesearch"),$(t).find(".icon").removeClass("active");var n=$(t).find(".js-icontext");n.length>0?n.html("Save"):$(t).html("Save")}),$(".js-user-searchalertset").each(function(e,t){$(t).removeClass("js-user-searchalertset").addClass("js-user-setsearchalert"),$(t).find(".icon").removeClass("active");var n=$(t).find(".js-icontext");n.length>0?n.html("Alerts"):$(t).html("Alerts")});if(!HMSUser.isLoggedout()){var e=null,t;HMSUser.isHomeValueSearch()||HMSUser.isRecentSalesSearch()?t="g_strLastHomeValueSearch":t="g_strLastSearch",e=$.cookie(t);var n=[],r=[],i=[];$.each(HMSUser.model.get("ssqs"),function(e,t){n.push(parseInt(e)),r.push(t),i.push(HMSUser.model.attributes.ssalerts[e])}),r.length>0&&(e&&e.length>0&&(e.indexOf("?")==0&&(e=e.substring(1,e.length)),$(".js-user-savesearch").each(function(t,s){var o=$(".js-user-setsearchalert");o.attr("data-savedsearchid",""),$(s).attr("data-savedsearchid","");var u=-1;$.each(r,function(t,n){N(e,n)&&(u=t)});if(u!=-1){$(s).removeClass("js-user-savesearch").addClass("js-user-searchsaved"),$(s).find(".icon").addClass("active");var a=$(s).find(".js-icontext");a.length>0?a.html("Saved"):$(s).html("Saved");var f=n[u];o.attr("data-savedsearchid",f),$(s).attr("data-savedsearchid",f);if(i[u]!=""){o.removeClass("js-user-setsearchalert").addClass("js-user-searchalertset"),o.find(".icon").addClass("active");var l=o.find(".js-icontext");l.length>0?l.html("Edit alert"):o.html("Edit alert")}}})),$(".js-searchitem").each(function(e,t){var r=$(t).data("savedsearchid"),s=$.inArray(r,n);if(s!=-1&&i[s]!=""){var o=$(".js-searchitem[data-savedsearchid="+r+"] .js-user-setsearchalert");o.removeClass("js-user-setsearchalert").addClass("js-user-searchalertset"),o.find(".icon").addClass("active");var u=o.find(".js-icontext");u.length>0?u.html("Edit alert"):o.html("Edit alert")}})),HMSUser.model.set("savedsearchesCount",r.length)}HMSEvent.trigger("ui-update-classes")},updateSavedSearchesCount:function(){var e="";HMSUser.model.get("savedsearchesCount")>0&&(e="("+HMSUser.model.get("savedsearchesCount")+")"),$(".js-savedsearches-count").html(e)},removeSavedSearch:function(e){e.attributes.success&&(this.model.set("ssqs",e.attributes.ssqs),this.model.set("savedsearches",e.attributes.savedsearches),HMSEvent.trigger("user-refresh-savedsearches",{refresh:!0}))},hideListing:function(e){e.preventDefault();if(HMSUser.isUserReady){var t=$(e.currentTarget),r=null,i=null;i=parseInt(t.data("listingid"),0),i>0||(i=parseInt(t.parent().data("listingid"),0)),i>0||(i=parseInt(t.parent().parent().data("listingid"),0));if(isNaN(i)||i==0){var s=$(".js-listitem");r=new n.HVHideListing({},{siteid:"68000000"}),r.loadFromMData({el:s}),i=parseInt(r.get("HVListingID")),i>0&&($(".js-user-hidelisting").attr("data-listingid",i),r.set("ListingID",i))}if(isNaN(i)||i==0)i=parseInt(t.data("hvlistingid"),0),i>0&&($(".js-user-hidelisting").attr("data-listingid",i),r.set("ListingID",i));HMSUser.isLoggedout()?HMSEvent.trigger("user-show-register",{action:"hidelisting",ListingID:i}):i>0&&$(".js-user-hidelisting[data-listingid="+i+"]").enConfirm({callback:function(){r||(r=new n.HideListing({ListingID:i},{siteid:"68000000"})),r.save(null,{success:function(e){e.attributes.success||HMSEvent.trigger("ui-notify",{msg:e.attributes.message}),e.attributes.success&&(HMSUser.model.set("savedlistings",e.attributes.savedlistings),HMSUser.model.set("slids",e.attributes.slids),HMSUser.model.set("slalerts",e.attributes.slalerts),HMSUser.model.set("hlids",e.attributes.hlids),HMSEvent.trigger("user-refresh-hidelisting"))}})},showDontAskAgain:!0,skipConfirmation:!0})}},unhideListing:function(e){e.preventDefault();if(HMSUser.isUserReady){var t=$(e.currentTarget),r=null,i=null;i=parseInt(t.data("listingid"),0),i>0||(i=parseInt(t.parent().data("listingid"),0)),i>0||(i=parseInt(t.parent().parent().data("listingid"),0));if(i==0){var s=$(".js-listitem");r=new n.UnhideListing({},{siteid:"68000000"}),r.loadFromMData({el:s}),i=parseInt(r.get("HVListingID")),i>0&&($(".js-user-listinghidden").attr("data-listingid",i),r.set("ListingID",i))}i>0&&$(".js-user-listinghidden[data-listingid="+i+"]").enConfirm({callback:function(){r||(r=new n.UnhideListing({ListingID:i},{siteid:"68000000"})),r.save(null,{success:function(e){e.attributes.success||HMSEvent.trigger("ui-notify",{msg:e.attributes.message}),e.attributes.success&&(HMSUser.model.set("savedlistings",e.attributes.savedlistings),HMSUser.model.set("slids",e.attributes.slids),HMSUser.model.set("slalerts",e.attributes.slalerts),HMSUser.model.set("hlids",e.attributes.hlids),HMSEvent.trigger("user-refresh-hidelisting"))}})},showDontAskAgain:!0,skipConfirmation:!0})}},shareListing:function(e){e.preventDefault(),$(".share-social-buttons").css({top:e.clientX,left:e.clientY}).show()},isHomeValueSearch:function(){return window.location.pathname.indexOf("homevalues")==1?!0:!1},isRecentSalesSearch:function(){return o.getActiveTab()=="recent"?!0:!1},isForeclosureSearch:function(){var e=o.getActiveTab();return e=="foreclosures"||e=="map"&&o.IsForeclosureTabActiveOnMap()?!0:!1},showSocialLogin:function(e){if(this.isLoggedout()){this.socialLogin||(this.socialLogin=new u.SocialLogin(this.settings));var t=e.target.getAttribute("data-social");switch(t){case"facebook":this.socialLogin.showSocialLoginFacebook();break;case"google":this.socialLogin.showSocialLoginGoogle();break;case"twitter":this.moreSocialInfoModal||(this.moreSocialInfoModal=new u.MoreSocialInfo(this.settings));var n=$.parseJSON(e.target.getAttribute("data-settings"));this.moreSocialInfoModal.render(n);break;case"linkedin":this.moreSocialInfoModal||(this.moreSocialInfoModal=new u.MoreSocialInfo(this.settings));var n=$.parseJSON(e.target.getAttribute("data-settings"));this.moreSocialInfoModal.render(n)}}}}),u.Login=e.View.extend({model:new n.LoginForm({siteid:HmsPrimarySiteID}),initialize:function(e){this.settings=e,_.bindAll(this,"render","renderCallback","doLogin","reLogin"),HMSEvent.on("user-relogin",this.reLogin,this),HMSEvent.on("save-"+this.model.name,this.doLogin,this),this.mediator=t.Mediator({model:this.model}),this.model.fetch({success:function(e){if(e.attributes.success){HMSUser.model.set(e);var t=HMSTrackingVars.PageName;if(t=="Property Search Results"||t=="Foreclosure Details"){var r=HMSUser.model.get("email"),i=HMSUser.model.get("firstName")+" "+HMSUser.model.get("lastName"),s=HMSUser.model.get("phone")||"",o=new n.ForeclosureAuth({email:r,name:i,phone:s,action:"auth"});o.fetch({success:function(e,t){HMSUser.model.set("foreclosureAuthentication",t),t.UserExists&&t.UserToken.length>0&&(HMSUser.model.set("isForeclosureAuth",!0),HMSEvent.trigger("user-foreclosure-reloadpage"),$.log("user.login"))},error:function(){}})}}else HMSUser.model.setDefaults(),HMSUser.model.set({userId:"notloggedin"}),HMSUser.model.set("isForeclosureAuth",!1);HMSUser.isUserReady=!0,HMSEvent.trigger("onUserReady",e)},error:function(){}})},render:function(e){var t=e&&e.action=="savelisting",n=e&&e.action=="savesearch";this.data=e,e&&t?HMSTemplate.get([h,w],this.renderCallback):e&&n?HMSTemplate.get([h,E],this.renderCallback):HMSTemplate.get([h],this.renderCallback)},renderCallback:function(e){var t,n;e[0]?(t=e[0],n=e[1]):t=e,this.model.reset();var r="",s=this.data&&this.data.action=="savelisting",o=this.data&&this.data.action=="savesearch",u=this.data&&this.data.action=="hidelisting",a="",l="";if(s||o)a='<div data-class="modal fixed-8of10 skin-9">';this.data&&s&&(r+=n.render(this.data),this.data.ListingID&&this.model.set("ListingID",this.data.ListingID),this.data.action&&this.model.set("action",this.data.action),this.data.SavedListingTypeID&&this.model.set("SavedListingTypeID",this.data.SavedListingTypeID),this.data.SavedListingID&&this.model.set("SavedListingID",this.data.SavedListingID),this.data.StatusAlert&&this.model.set("StatusAlert",this.data.StatusAlert),this.data.AlertFrequency&&this.model.set("AlertFrequency",this.data.AlertFrequency),this.data.SimilarHomesAlert&&this.model.set("SimilarHomesAlert",this.data.SimilarHomesAlert)),this.data&&o&&(r+=n.render(this.data),this.data.SearchQueryString&&this.model.set("SearchQueryString",this.data.SearchQueryString),this.data.action&&this.model.set("action",this.data.action),this.data.SavedSearchesTypeID&&this.model.set("SavedSearchesTypeID",this.data.SavedSearchesTypeID),this.data.AlertFrequency&&this.model.set("AlertFrequency",this.data.AlertFrequency),this.data.SimilarHomesAlert&&this.model.set("SimilarHomesAlert",this.data.SimilarHomesAlert)),this.data&&u&&(this.data.ListingID&&this.model.set("ListingID",this.data.ListingID),this.data.action&&this.model.set("action",this.data.action)),this.data||(this.data={}),this.data.dontshowfacebook=f,this.data.showfacebook=!this.data.dontshowfacebook,this.data.showABTesting=_showABTesting;if(!this.data||!i.convertToBool(this.data.IsForeclosure))this.data.IsForeclosure=null;var c=!1;$.cookie("loginRemember")&&$.cookie("loginRemember")=="true"&&(this.data.loginRemember=!0),r+=t.render(this.data);if(s||o)l="</div>";r=a+r+l,HMSEvent.trigger("ui-modal-open",{content:r}),this.setElement("#js-rmx-login"),s||o?this.mediator.prepareModel(this.$el.parent()):this.mediator.prepareModel(this.$el),this.data&&(s||o)&&($("#js-login-header").hide(),$(".js-gridrow").hide(),$("button.js-sl-setbtn").hide(),$("button.js-sl-removebtn").hide(),$(".js-vyp").hide(),$(".js-sl-similarhomesalert").click(function(){$(".js-sl-alertfrequency").parent().toggle()})),$('input[name="login_email"]').val(""),$('input[name="login_password"]').val(""),this.data.loginRemember&&($.cookie("loginEmail")&&$('input[name="login_email"]').val($.cookie("loginEmail")).blur(),$.cookie("loginPassword")&&$('input[name="login_password"]').val(Tea.decrypt($.cookie("loginPassword"),pwd)).blur()),this.data.callback&&(this.settings.callback=this.data.callback),this.data.args&&(this.settings.args=this.data.args),this.model.get("StatusAlert")&&(this.data.StatusAlert=this.model.get("StatusAlert")),this.model.get("AlertFrequency")&&(this.data.AlertFrequency=this.model.get("AlertFrequency")),this.model.get("SimilarHomesAlert")&&(this.data.SimilarHomesAlert=this.model.get("SimilarHomesAlert"));var h=this.$el.find(".js-user-register");h.data("data",this.data);var p=this.$el.find("[data-id='js-social-login']");p.data("data",this.data)},doLogin:function(t){HMSEvent.trigger("ui-remove-notify");var r=this,i=r.$el;HMSEvent.trigger("ui-show-blocker",{element:i,overlay:{opacity:.2,cursor:"default"}});var s="",o=!1;t.get("login_remember")&&(o=!0,s=Tea.encrypt($('input[name="login_password"]').val(),pwd)),$.cookie("loginRemember",o,{path:"/"}),t&&t.save(null,{success:function(e){HMSEvent.trigger("ui-hide-blocker",{element:i});if(e.attributes.success){HMSUser.model.set(e),r.settings.callback&&r.settings.args&&r.settings.callback(r.settings.args),$.cookie("loginEmail","",{path:"/"}),$.cookie("loginPassword","",{path:"/"}),o&&($.cookie("loginEmail",e.attributes.email,{path:"/"}),$.cookie("loginPassword",s,{path:"/"})),HMSEvent.trigger("TrackForm",{formid:"signin",status:"S"}),HMSEvent.trigger("ui-modal-close");var t=HMSTrackingVars.PageName;HMSUser.model.set("isForeclosureAuth",!1);if(t=="Property Search Results"||t=="Foreclosure Details"){var u=HMSUser.model.get("email"),a=HMSUser.model.get("firstName")+" "+HMSUser.model.get("lastName"),f=HMSUser.model.get("phone")||"",l=new n.ForeclosureAuth({email:u,name:a,phone:f});l.fetch({success:function(e,n){HMSUser.model.set("foreclosureAuthentication",n),r.data&&r.data.IsForeclosure&&t=="Foreclosure Details"&&HMSEvent.trigger("user-show-foreclosure"),t=="Property Search Results"&&n.UserExists&&n.UserToken.length>0&&(HMSUser.model.set("isForeclosureAuth",!0),HMSEvent.trigger("user-foreclosure-reloadpage"),$.log("do.login"))},error:function(){}})}HMSEvent.trigger("ui-show-agentbranding",{forceagentbranding:!0}),window.location.pathname=="/"&&(window.location.href="/myremax/#accountsettings")}else HMSUser.model.set({loginFailure:!0})},error:function(){}})},reLogin:function(){this.model.fetch({success:function(e){e.attributes.success?HMSUser.model.set(e):(HMSUser.model.setDefaults(),HMSUser.model.set({userId:"notloggedin"}))},error:function(){}})}}),u.Register=e.View.extend({model:new n.RegisterForm({siteid:"68000000"}),initialize:function(e){this.settings=e,_.bindAll(this,"render","renderCallback","doRegister"),HMSEvent.on("save-"+this.model.name,this.doRegister,this),this.mediator=t.Mediator({model:this.model})},render:function(e){this.data=e,HMSTemplate.get(d,this.renderCallback)},renderCallback:function(e){$(".model-user-login").removeClass("model-user-login"),this.model.reset();var t="",n=this.data&&this.data.action=="savelisting",r=this.data&&this.data.action=="savesearch",s=this.data&&this.data.action=="hidelisting";this.data&&n&&(this.data.ListingID&&this.model.set("ListingID",this.data.ListingID),this.data.action&&this.model.set("action",this.data.action),this.data.SavedListingTypeID&&this.model.set("SavedListingTypeID",this.data.SavedListingTypeID),this.data.AlertFrequency&&this.model.set("AlertFrequency",this.data.AlertFrequency),this.data.SavedListingID&&this.model.set("SavedListingID",this.data.SavedListingID),this.data.SimilarHomesAlert&&this.model.set("SimilarHomesAlert",this.data.SimilarHomesAlert),this.data.StatusAlert&&this.model.set("StatusAlert",this.data.StatusAlert)),this.data&&r&&(this.data.SearchQueryString&&this.model.set("SearchQueryString",this.data.SearchQueryString),this.data.action&&this.model.set("action",this.data.action),this.data.SavedSearchesTypeID&&this.model.set("SavedSearchesTypeID",this.data.SavedSearchesTypeID),this.data.AlertFrequency&&this.model.set("AlertFrequency",this.data.AlertFrequency),this.data.SimilarHomesAlert&&this.model.set("SimilarHomesAlert",this.data.SimilarHomesAlert)),this.data&&s&&(this.data.ListingID&&this.model.set("ListingID",this.data.ListingID),this.data.action&&this.model.set("action",this.data.action)),this.data||(this.data={}),this.data.dontshowfacebook=f,this.data.showfacebook=!this.data.dontshowfacebook,this.data.showABTesting=_showABTesting;if(!this.data||!i.convertToBool(this.data.IsForeclosure))this.data.IsForeclosure=null;this.data.callback&&(this.settings.callback=this.data.callback),this.data.args&&(this.settings.args=this.data.args);var t=e.render(this.data);HMSEvent.trigger("ui-modal-open",{content:t}),this.setElement("#js-rmx-register"),HMSEvent.trigger("ui-set-passwordlimitmessage"),this.mediator.prepareModel(this.$el),$('input[name="registration_name"]').val(""),$('input[name="registration_email"]').val(""),$('input[name="registration_phone"]').val(""),$('input[name="registration_password"]').val(""),$('input[name="registration_password_confirm"]').val(""),this.data.Location&&$('input[name="registration_location"]').val(this.data.Location);var o=this.$el.find(".js-user-login");o.data("data",this.data);var u=this.$el.find("[data-id='js-social-login']");u.data("data",this.data)},doRegister:function(t){var r=this,s=this.$el;HMSEvent.trigger("ui-show-blocker",{element:s,overlay:{opacity:.2,cursor:"default"}});var o="",u=!1;t.get("login_remember")&&(u=!0,o=Tea.encrypt($('input[name="registration_password"]').val(),pwd)),$.cookie("loginRemember",u,{path:"/"}),$.cookie("g_strLastListingViewed")&&t&&!t.get("ListingID")&&t.set("ListingID",$.cookie("g_strLastListingViewed")),t&&t.save(null,{success:function(e){HMSEvent.trigger("ui-hide-blocker",{element:s});if(e.attributes.success){HMSUser.model.set(e),r.settings.callback&&r.settings.args&&r.settings.callback(r.settings.args),$.cookie("loginEmail","",{path:"/"}),$.cookie("loginPassword","",{path:"/"}),u&&($.cookie("loginEmail",e.attributes.email,{path:"/"}),$.cookie("loginPassword",o,{path:"/"})),HMSEvent.trigger("TrackForm",{formid:"registration",status:"S"}),HMSEvent.trigger("ui-modal-close");var t=HMSTrackingVars.PageName;HMSUser.model.set("isForeclosureAuth",!1);if(r.data&&i.convertToBool(r.data.IsForeclosure)&&(t=="Property Search Results"||t=="Foreclosure Details")){var a=HMSUser.model.get("email"),f=HMSUser.model.get("firstName")+" "+HMSUser.model.get("lastName"),l=HMSUser.model.get("phone")||"",c=new n.ForeclosureAuth({email:a,name:f,phone:l});c.fetch({success:function(e,n){HMSUser.model.set("foreclosureAuthentication",n),r.data&&r.data.IsForeclosure&&t=="Foreclosure Details"&&HMSEvent.trigger("user-show-foreclosure"),t=="Property Search Results"&&n.UserExists&&n.UserToken.length>0&&(HMSUser.model.set("isForeclosureAuth",!0),HMSEvent.trigger("user-foreclosure-reloadpage"),$.log("do.register"))},error:function(){}})}window.location.pathname=="/"&&setTimeout(function(){window.location.href="/myremax/#accountsettings"},1e3)}else HMSUser.model.set({registerFailure:!0,message:e.get("message")})},error:function(){}})}}),u.ForgotPassword=e.View.extend({model:new n.ForgotPasswordForm({siteid:"68000000"}),initialize:function(e){_.bindAll(this,"renderCallback"),this.settings=e,HMSEvent.on("save-"+this.model.name,this.doForgotPassword,this),this.mediator=t.Mediator({model:this.model})},render:function(){HMSTemplate.get(p,this.renderCallback)},renderCallback:function(e){$(".model-user-login").removeClass("model-user-login"),this.model.reset();var t=e.render();HMSEvent.trigger("ui-modal-open",{content:t}),this.setElement("#js-rmx-forgotpassword"),this.mediator.prepareModel(this.$el)},doForgotPassword:function(t){var n=this.$el;HMSEvent.trigger("ui-show-blocker",{element:n,overlay:{opacity:.2,cursor:"default"}}),t&&t.save(null,{success:function(e){HMSEvent.trigger("ui-hide-blocker",{element:n}),e.attributes.success?(HMSEvent.trigger("ui-modal-close"),HMSEvent.trigger("ui-notify",{msg:"Sent! You're good to go.",mode:"popup"})):HMSEvent.trigger("ui-notify",{msg:"Sorry - we couldn't find your account with that email.  Please check your entry and try again.",mode:"inline",selector:"#js-errormessage-forgotpassword"})}})}}),u.SaveListing=e.View.extend({model:new n.SavedListing(null,{siteid:"68000000"}),events:{"click .js-sl-similarhomesalert":"toggleAlertFrequency"},initialize:function(e){this.settings=e,_.bindAll(this,"render","renderCallback","saveListing"),HMSEvent.on("save-"+this.model.name,this.saveListing,this),this.mediator=t.Mediator({model:this.model})},render:function(e){this.data=e,HMSTemplate.get(w,this.renderCallback)},renderCallback:function(e){this.data&&(this.data.ListingID&&this.model.set("ListingID",this.data.ListingID),this.data.SavedListingID?this.model.set("SavedListingID",this.data.SavedListingID):this.model.set("SavedListingID",null),this.data.action&&this.model.set("action",this.data.action),this.data.IsForeclosure&&this.data.IsForeclosure.toLowerCase()=="true"&&(this.data.SavedListingTypeID="151"),this.data.SavedListingTypeID&&this.model.set("SavedListingTypeID",this.data.SavedListingTypeID)),this.model.set("savedlistings",null),this.data.Address==""&&(this.data.Address=null),this.data.City==""&&(this.data.City=null),this.data.State==""&&(this.data.State=null),this.data.Zip==""&&(this.data.Zip=null);var t=e.render(this.data);HMSEvent.trigger("ui-modal-open",{content:t});var n=".js-sl-slider",r=$(n),i=r.data("ranking")?r.data("ranking"):50;this.slider=new s.View({type:"ranking",animate:!0,el:n,value:i,defaultvalue:50,min:0,max:100,range:"min"}),this.setElement("#js-rmx-savelisting"),this.mediator.prepareModel(this.$el)},saveListing:function(t){var n=this.$el;HMSEvent.trigger("ui-show-blocker",{element:n,overlay:{opacity:.2,cursor:"default"}}),this.model.set("Ranking",this.slider.value),t&&t.save(null,{success:function(e){HMSEvent.trigger("ui-hide-blocker",{element:n}),e.attributes.success||HMSEvent.trigger("ui-notify",{msg:e.attributes.message,mode:"popup",selector:"#js-errormessage-savelisting"}),e.attributes.success&&(e.attributes.savedlistings&&HMSUser.model.set("savedlistings",e.attributes.savedlistings),e.attributes.slids&&HMSUser.model.set("slids",e.attributes.slids),e.attributes.sllistingsourceids&&HMSUser.model.set("sllistingsourceids",e.attributes.sllistingsourceids),e.attributes.slalerts&&HMSUser.model.set("slalerts",e.attributes.slalerts),e.attributes.hlids&&HMSUser.model.set("hlids",e.attributes.hlids),e.attributes.savedsearches&&HMSUser.model.set("savedsearches",e.attributes.savedsearches),e.attributes.ssqs&&HMSUser.model.set("ssqs",e.attributes.ssqs),e.attributes.ssalerts&&HMSUser.model.set("ssalerts",e.attributes.ssalerts),e.attributes.action=="savestatusalert"&&(e.attributes.StatusAlert.toLowerCase()=="true"?HMSUser.model.attributes.slalerts[e.attributes.ListingID]="true":HMSUser.model.attributes.slalerts[e.attributes.ListingID]="false"),HMSEvent.trigger("ui-modal-close"),HMSEvent.trigger("user-update-savedlistings"))}})},toggleAlertFrequency:function(){$(".js-sl-alertfrequency").parent().toggle()}}),u.SaveSearch=e.View.extend({model:new n.SavedSearch(null,{siteid:"68000000"}),events:{"click .js-sl-similarhomesalert":"toggleAlertFrequency"},initialize:function(e){this.settings=e,_.bindAll(this,"render","renderCallback","saveSearch"),HMSEvent.on("save-"+this.model.name,this.saveSearch,this),this.mediator=t.Mediator({model:this.model})},render:function(e){this.data=e,this.model.reset(),this.data&&this.data.SearchQueryString&&this.model.set("SearchQueryString",this.data.SearchQueryString),this.data&&this.data.SavedSearchID&&this.model.set("SavedSearchID",this.data.SavedSearchID),this.data&&this.data.SavedSearchesTypeID&&this.model.set("SavedSearchesTypeID",this.data.SavedSearchesTypeID),this.model.set("savedsearches",null),HMSTemplate.get(E,this.renderCallback)},renderCallback:function(e){var t=e.render(this.data);HMSEvent.trigger("ui-modal-open",{content:t}),this.setElement("#js-rmx-savesearch"),this.mediator.prepareModel(this.$el)},saveSearch:function(t){var n=this.$el;HMSEvent.trigger("ui-show-blocker",{element:n,overlay:{opacity:.2,cursor:"default"}}),t.attributes.ssqs=null,t.attributes.ssalerts=null,t.attributes.savedsearches=null,t.attributes.action=null,t.attributes.currentTargetClassName&&t.attributes.currentTargetClassName.indexOf("js-sl-removebtn")!=-1&&(t.set("action","removealert"),t.set("SimilarHomesAlert",!1)),t.save(null,{success:function(e){HMSEvent.trigger("ui-hide-blocker",{element:n}),e.attributes.success||HMSEvent.trigger("ui-notify",{msg:e.attributes.message,mode:"popup",selector:"#js-errormessage-savesearch"}),e.attributes.success&&(e.attributes.savedsearches&&HMSUser.model.set("savedsearches",e.attributes.savedsearches),e.attributes.ssqs&&HMSUser.model.set("ssqs",e.attributes.ssqs),e.attributes.ssalerts&&HMSUser.model.set("ssalerts",e.attributes.ssalerts),HMSEvent.trigger("ui-modal-close"))}})},toggleAlertFrequency:function(){$(".js-sl-alertfrequency").parent().toggle()}}),u.SocialLogin=e.View.extend({el:"[data-id='js-social-login']",model:new n.SocialLogin({siteid:"68000000"}),initialize:function(e){this.settings=e,_.bindAll(this,"showSocialLoginFacebook","showSocialLoginGoogle","doSocialLogin","getMoreInfo","doOtherSocialLogin"),HMSEvent.on("DoSocialLogin",this.doSocialLogin,this),HMSEvent.on("more-info-social",this.doOtherSocialLogin)},getMoreInfo:function(e){},doOtherSocialLogin:function(e){var t=window.location.pathname,n=e.data,r="/system/oauth2handler2.aspx?";this.model.social=n.social,r+="pid="+n.pid+"&pu="+n.popup+"&return="+escape(t)+"&scope="+n.scope+"&email="+n.email,window.open(r,"socWin","width="+n.width+",height="+n.height)},showSocialLoginFacebook:function(){this.setElement($("[data-social='facebook']"));var e=this.$el.data("data");e&&e.callback&&(this.settings.callback=e.callback),e&&e.args&&(this.settings.args=e.args);var t=window.location.pathname,n=this.$el.data("settings"),r="/system/oauth2handler2.aspx?";this.model.social=n.social,r+="pid="+n.pid+"&return="+escape(t)+"&scope="+n.scope+"&pu="+n.popup,window.open(r,"socWin","width="+n.width+",height="+n.height)},showSocialLoginGoogle:function(){this.setElement($("[data-social='google']"));var e=this.$el.data("data");e&&e.callback&&(this.settings.callback=e.callback),e&&e.args&&(this.settings.args=e.args);var t=window.location.pathname,n=this.$el.data("settings"),r="/system/oauth2handler2.aspx?";this.model.social=n.social,r+="pid="+n.pid+"&return="+escape(t)+"&scope="+n.scope+"&pu="+n.popup,window.open(r,"socWin","width="+n.width+",height="+n.height)},doSocialLogin:function(){var e=this,t=e.model,r=e.$el,i=r.data("data");i&&i.args&&(i.args=null),i&&i.callback&&(i.callback=null),i&&t.set(i),HMSEvent.trigger("ui-show-blocker",{element:r,overlay:{opacity:.2,cursor:"default"}}),t&&t.save(null,{success:function(t){HMSEvent.trigger("ui-hide-blocker",{element:r});if(t.attributes.success){HMSUser.model.set(t),HMSEvent.trigger("TrackForm",{formid:"signin",status:"S",SocialID:e.model.social}),e.settings.callback&&e.settings.args&&e.settings.callback(e.settings.args);var i=HMSTrackingVars.PageName;HMSUser.model.set("isForeclosureAuth",!1);if(i=="Property Search Results"||i=="Foreclosure Details"){var s=HMSUser.model.get("email"),o=HMSUser.model.get("firstName")+" "+HMSUser.model.get("lastName"),u=HMSUser.model.get("phone")||"",a=new n.ForeclosureAuth({email:s,name:o,phone:u});a.fetch({success:function(t,n){HMSUser.model.set("foreclosureAuthentication",n),e.data&&e.data.IsForeclosure&&i=="Foreclosure Details"&&HMSEvent.trigger("user-show-foreclosure"),i=="Property Search Results"&&n.UserExists&&n.UserToken.length>0&&(HMSUser.model.set("isForeclosureAuth",!0),HMSEvent.trigger("user-foreclosure-reloadpage"))},error:function(){}})}}else HMSUser.model.set({loginFailure:!0});HMSEvent.trigger("ui-modal-close")}})}}),u.MoreSocialInfo=e.View.extend({model:null,el:$("#js-modal-moresocialinfo"),events:{"click .js-modal-close":"onModalClose","click .js-moreinfo-submit":"onMoreInfoSubmit"},settings:{},socialType:"",initialize:function(e){_.extend(this.settings,e),_.bindAll(this,"render","renderCallback","onModalClose","onMoreInfoSubmit","doMoreInfoSocial"),this.model=new n.MoreSocialInfo({siteid:"68000000"}),HMSEvent.on("save-"+this.model.name,this.doMoreInfoSocial,this),this.mediator=t.Mediator({model:this.model})},render:function(e){this.settings=e,HMSTemplate.get(x,this.renderCallback)},renderCallback:function(e){var t=this.settings.social.charAt(0).toUpperCase()+this.settings.social.substring(1);this.settings.socialName=t;var n="";n+=e.render(this.settings),$(".model-user-forgotpassword").removeClass("model-user-forgotpassword"),this.model.reset(),HMSEvent.trigger("ui-modal-open",{content:n}),this.setElement($("#js-modal-moresocialinfo")),this.mediator.prepareModel(this.$el)},doMoreInfoSocial:function(t){var n=this.$el,r=t.toJSON().email;this.settings.email=r,HMSEvent.trigger("more-info-social",{data:this.settings}),HMSEvent.trigger("ui-modal-close")},onMoreInfoSubmit:function(e){HMSEvent.trigger("ui-modal-close")},onModalClose:function(e){HMSEvent.trigger("ui-modal-close")}}),a.execute=function(e){HMSUser||(HMSUser=new u.Details(e))},HMSEvent.on("user-update-savedlistings",function(){HMSUser||(HMSUser=new u.Details(options)),HMSUser.updateSavedListings(),HMSUser.updateHiddenListings()}),HMSEvent.on("user-update-savedsearch",function(){HMSUser||(HMSUser=new u.Details(options)),HMSUser.updateSavedSearches()}),HMSEvent.on("user-savelisting",function(e){HMSUser||(HMSUser=new u.Details(options)),HMSUser.saveListing(e)}),HMSEvent.on("user-hidelisting",function(e){HMSUser||(HMSUser=new u.Details(options)),HMSUser.hideListing(e.e),e.callback&&e.args&&e.callback(e.args)}),HMSEvent.on("user-unhidelisting",function(e){HMSUser||(HMSUser=new u.Details(options)),HMSUser.unhideListing(e.e),e.callback&&e.args&&e.callback(e.args)}),a})